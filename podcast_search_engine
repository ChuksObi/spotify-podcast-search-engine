{"cells":[{"cell_type":"markdown","metadata":{"id":"qfO7KkEzNvDf"},"source":["# ECS736P Assignment 3 - Group 84"]},{"cell_type":"markdown","metadata":{"id":"UXJAxCLrZMRu"},"source":["## Import Spotify Podcasts Metadata\n","This consists of the metadata from the Spotify English-language Podcast Dataset available from https://podcastsdataset.byspotify.com/. We trialled taking show or episode descriptions as documents to be indexed. Episode descriptions gave the best results for the search engine as they provide information specific to the single episode/document."]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":19239,"status":"ok","timestamp":1650028101814,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"h7Flw0yVdx7g","outputId":"f0d65bf6-3109-4031-8cc8-e0013f5acb48"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/gdrive\n"]}],"source":["import pandas as pd\n","\n","from google.colab import drive\n","drive.mount('/content/gdrive', force_remount=True)"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"uy_Ro7XMd1Hz","executionInfo":{"status":"ok","timestamp":1650028105682,"user_tz":-60,"elapsed":3874,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# Tom A\n","metadata = pd.read_csv('/content/gdrive/MyDrive/Postgrad/Information Retrieval/IR Group Assignments/Assignment2/Code/metadata.tsv', sep='\\t')"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"CWJlFt65Djge","executionInfo":{"status":"ok","timestamp":1650028105683,"user_tz":-60,"elapsed":16,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# Tyler\n","#metadata = pd.read_csv('/content/gdrive/MyDrive/QMUL DS and AI Studies/Semester B/Information Retrieval/Datasets/metadata.tsv', sep='\\t')"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":530},"executionInfo":{"elapsed":15,"status":"ok","timestamp":1650028105684,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"ijCCDgFMe9_f","outputId":"b2665603-6e42-48c7-fb3f-b21a0406dd1f"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                              show_uri  \\\n","0  spotify:show:2NYtxEZyYelR6RMKmjfPLB   \n","1  spotify:show:15iWCbU7QoO23EndPEO6aN   \n","2  spotify:show:6vZRgUFTYwbAA79UNCADr4   \n","3  spotify:show:5BvKEjaMSuvUsGROGi2S7s   \n","4  spotify:show:7w3h3umpH74veEJcbE6xf4   \n","\n","                                           show_name  \\\n","0                               Kream in your Koffee   \n","1                              Morning Cup Of Murder   \n","2  Inside The 18 : A Podcast for Goalkeepers by G...   \n","3                                    Arrowhead Live!   \n","4                                              FBoL    \n","\n","                                    show_description               publisher  \\\n","0  A 20-something blunt female takes on the world...             Katie Houle   \n","1  Ever wonder what murder took place on today in...   Morning Cup Of Murder   \n","2  Inside the 18 is your source for all things Go...  Inside the 18 GK Media   \n","3  Your favorite podcast for everything @Chiefs! ...         Arrowhead Live!   \n","4  The comedy podcast about toxic characters, wri...           Emily Edwards   \n","\n","    language                                           rss_link  \\\n","0     ['en']           https://anchor.fm/s/11b84b68/podcast/rss   \n","1     ['en']            https://anchor.fm/s/b07181c/podcast/rss   \n","2     ['en']            https://anchor.fm/s/81a072c/podcast/rss   \n","3  ['en-US']            https://anchor.fm/s/917dba4/podcast/rss   \n","4     ['en']  https://www.fuckboisoflit.com/episodes?format=rss   \n","\n","                              episode_uri  \\\n","0  spotify:episode:000A9sRBYdVh66csG2qEdj   \n","1  spotify:episode:000HP8n3hNIfglT2wSI2cA   \n","2  spotify:episode:001UfOruzkA3Bn1SPjcdfa   \n","3  spotify:episode:001i89SvIQgDuuyC53hfBm   \n","4  spotify:episode:0025RWNwe2lnp6HcnfzwzG   \n","\n","                                        episode_name  \\\n","0                            1: It’s Christmas Time!   \n","1  The Goleta Postal Facility shootings- January ...   \n","2  Ep.36 - Incorporating a Singular Goalkeeping C...   \n","3                   Episode 1: Arrowhead Live! Debut   \n","4  The Lion, The Witch, And The Wardrobe - Ashley...   \n","\n","                                 episode_description   duration  \\\n","0  On the first ever episode of Kream in your Kof...  12.700133   \n","1  See something, say something. It’s a mantra ma...   6.019383   \n","2  Today’s episode is a sit down Michael and Omar...  43.616333   \n","3  Join us as we take a look at all current Chief...  58.189200   \n","4  The modern morality tail of how to stay good f...  51.782050   \n","\n","          show_filename_prefix episode_filename_prefix  \n","0  show_2NYtxEZyYelR6RMKmjfPLB  000A9sRBYdVh66csG2qEdj  \n","1  show_15iWCbU7QoO23EndPEO6aN  000HP8n3hNIfglT2wSI2cA  \n","2  show_6vZRgUFTYwbAA79UNCADr4  001UfOruzkA3Bn1SPjcdfa  \n","3  show_5BvKEjaMSuvUsGROGi2S7s  001i89SvIQgDuuyC53hfBm  \n","4  show_7w3h3umpH74veEJcbE6xf4  0025RWNwe2lnp6HcnfzwzG  "],"text/html":["\n","  <div id=\"df-d31137e6-cecc-4db0-b04d-d89193d075c4\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>show_uri</th>\n","      <th>show_name</th>\n","      <th>show_description</th>\n","      <th>publisher</th>\n","      <th>language</th>\n","      <th>rss_link</th>\n","      <th>episode_uri</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","      <th>duration</th>\n","      <th>show_filename_prefix</th>\n","      <th>episode_filename_prefix</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>spotify:show:2NYtxEZyYelR6RMKmjfPLB</td>\n","      <td>Kream in your Koffee</td>\n","      <td>A 20-something blunt female takes on the world...</td>\n","      <td>Katie Houle</td>\n","      <td>['en']</td>\n","      <td>https://anchor.fm/s/11b84b68/podcast/rss</td>\n","      <td>spotify:episode:000A9sRBYdVh66csG2qEdj</td>\n","      <td>1: It’s Christmas Time!</td>\n","      <td>On the first ever episode of Kream in your Kof...</td>\n","      <td>12.700133</td>\n","      <td>show_2NYtxEZyYelR6RMKmjfPLB</td>\n","      <td>000A9sRBYdVh66csG2qEdj</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>spotify:show:15iWCbU7QoO23EndPEO6aN</td>\n","      <td>Morning Cup Of Murder</td>\n","      <td>Ever wonder what murder took place on today in...</td>\n","      <td>Morning Cup Of Murder</td>\n","      <td>['en']</td>\n","      <td>https://anchor.fm/s/b07181c/podcast/rss</td>\n","      <td>spotify:episode:000HP8n3hNIfglT2wSI2cA</td>\n","      <td>The Goleta Postal Facility shootings- January ...</td>\n","      <td>See something, say something. It’s a mantra ma...</td>\n","      <td>6.019383</td>\n","      <td>show_15iWCbU7QoO23EndPEO6aN</td>\n","      <td>000HP8n3hNIfglT2wSI2cA</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>spotify:show:6vZRgUFTYwbAA79UNCADr4</td>\n","      <td>Inside The 18 : A Podcast for Goalkeepers by G...</td>\n","      <td>Inside the 18 is your source for all things Go...</td>\n","      <td>Inside the 18 GK Media</td>\n","      <td>['en']</td>\n","      <td>https://anchor.fm/s/81a072c/podcast/rss</td>\n","      <td>spotify:episode:001UfOruzkA3Bn1SPjcdfa</td>\n","      <td>Ep.36 - Incorporating a Singular Goalkeeping C...</td>\n","      <td>Today’s episode is a sit down Michael and Omar...</td>\n","      <td>43.616333</td>\n","      <td>show_6vZRgUFTYwbAA79UNCADr4</td>\n","      <td>001UfOruzkA3Bn1SPjcdfa</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>spotify:show:5BvKEjaMSuvUsGROGi2S7s</td>\n","      <td>Arrowhead Live!</td>\n","      <td>Your favorite podcast for everything @Chiefs! ...</td>\n","      <td>Arrowhead Live!</td>\n","      <td>['en-US']</td>\n","      <td>https://anchor.fm/s/917dba4/podcast/rss</td>\n","      <td>spotify:episode:001i89SvIQgDuuyC53hfBm</td>\n","      <td>Episode 1: Arrowhead Live! Debut</td>\n","      <td>Join us as we take a look at all current Chief...</td>\n","      <td>58.189200</td>\n","      <td>show_5BvKEjaMSuvUsGROGi2S7s</td>\n","      <td>001i89SvIQgDuuyC53hfBm</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>spotify:show:7w3h3umpH74veEJcbE6xf4</td>\n","      <td>FBoL</td>\n","      <td>The comedy podcast about toxic characters, wri...</td>\n","      <td>Emily Edwards</td>\n","      <td>['en']</td>\n","      <td>https://www.fuckboisoflit.com/episodes?format=rss</td>\n","      <td>spotify:episode:0025RWNwe2lnp6HcnfzwzG</td>\n","      <td>The Lion, The Witch, And The Wardrobe - Ashley...</td>\n","      <td>The modern morality tail of how to stay good f...</td>\n","      <td>51.782050</td>\n","      <td>show_7w3h3umpH74veEJcbE6xf4</td>\n","      <td>0025RWNwe2lnp6HcnfzwzG</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-d31137e6-cecc-4db0-b04d-d89193d075c4')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-d31137e6-cecc-4db0-b04d-d89193d075c4 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-d31137e6-cecc-4db0-b04d-d89193d075c4');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":5}],"source":["# full Spotify Podcasts Metadata\n","metadata[:5]"]},{"cell_type":"code","execution_count":6,"metadata":{"id":"c0ewHKc5X89H","executionInfo":{"status":"ok","timestamp":1650028105967,"user_tz":-60,"elapsed":293,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["metadf = metadata.loc[:,['episode_uri','show_name', 'show_description', 'episode_name', 'episode_description']]"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":337},"executionInfo":{"elapsed":21,"status":"ok","timestamp":1650028105969,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"u4W8IxMHXq7P","outputId":"6daee818-f2b4-48b1-d145-5626ab68f6d7"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                              episode_uri  \\\n","0  spotify:episode:000A9sRBYdVh66csG2qEdj   \n","1  spotify:episode:000HP8n3hNIfglT2wSI2cA   \n","2  spotify:episode:001UfOruzkA3Bn1SPjcdfa   \n","3  spotify:episode:001i89SvIQgDuuyC53hfBm   \n","4  spotify:episode:0025RWNwe2lnp6HcnfzwzG   \n","\n","                                           show_name  \\\n","0                               Kream in your Koffee   \n","1                              Morning Cup Of Murder   \n","2  Inside The 18 : A Podcast for Goalkeepers by G...   \n","3                                    Arrowhead Live!   \n","4                                              FBoL    \n","\n","                                    show_description  \\\n","0  A 20-something blunt female takes on the world...   \n","1  Ever wonder what murder took place on today in...   \n","2  Inside the 18 is your source for all things Go...   \n","3  Your favorite podcast for everything @Chiefs! ...   \n","4  The comedy podcast about toxic characters, wri...   \n","\n","                                        episode_name  \\\n","0                            1: It’s Christmas Time!   \n","1  The Goleta Postal Facility shootings- January ...   \n","2  Ep.36 - Incorporating a Singular Goalkeeping C...   \n","3                   Episode 1: Arrowhead Live! Debut   \n","4  The Lion, The Witch, And The Wardrobe - Ashley...   \n","\n","                                 episode_description docno  \n","0  On the first ever episode of Kream in your Kof...     0  \n","1  See something, say something. It’s a mantra ma...     1  \n","2  Today’s episode is a sit down Michael and Omar...     2  \n","3  Join us as we take a look at all current Chief...     3  \n","4  The modern morality tail of how to stay good f...     4  "],"text/html":["\n","  <div id=\"df-4d1d50ad-c5fb-4605-8ffd-e5327daff5a9\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>episode_uri</th>\n","      <th>show_name</th>\n","      <th>show_description</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","      <th>docno</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>spotify:episode:000A9sRBYdVh66csG2qEdj</td>\n","      <td>Kream in your Koffee</td>\n","      <td>A 20-something blunt female takes on the world...</td>\n","      <td>1: It’s Christmas Time!</td>\n","      <td>On the first ever episode of Kream in your Kof...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>spotify:episode:000HP8n3hNIfglT2wSI2cA</td>\n","      <td>Morning Cup Of Murder</td>\n","      <td>Ever wonder what murder took place on today in...</td>\n","      <td>The Goleta Postal Facility shootings- January ...</td>\n","      <td>See something, say something. It’s a mantra ma...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>spotify:episode:001UfOruzkA3Bn1SPjcdfa</td>\n","      <td>Inside The 18 : A Podcast for Goalkeepers by G...</td>\n","      <td>Inside the 18 is your source for all things Go...</td>\n","      <td>Ep.36 - Incorporating a Singular Goalkeeping C...</td>\n","      <td>Today’s episode is a sit down Michael and Omar...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>spotify:episode:001i89SvIQgDuuyC53hfBm</td>\n","      <td>Arrowhead Live!</td>\n","      <td>Your favorite podcast for everything @Chiefs! ...</td>\n","      <td>Episode 1: Arrowhead Live! Debut</td>\n","      <td>Join us as we take a look at all current Chief...</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>spotify:episode:0025RWNwe2lnp6HcnfzwzG</td>\n","      <td>FBoL</td>\n","      <td>The comedy podcast about toxic characters, wri...</td>\n","      <td>The Lion, The Witch, And The Wardrobe - Ashley...</td>\n","      <td>The modern morality tail of how to stay good f...</td>\n","      <td>4</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-4d1d50ad-c5fb-4605-8ffd-e5327daff5a9')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-4d1d50ad-c5fb-4605-8ffd-e5327daff5a9 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-4d1d50ad-c5fb-4605-8ffd-e5327daff5a9');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":7}],"source":["# generate docno column and convert all to strings for PyTerrier compatibility\n","metadf['docno'] = metadf.index\n","metadf = metadf.astype(str)\n","metadf[:5]"]},{"cell_type":"code","source":["# example metadata for presentation\n","metadf[['show_name', 'episode_name', 'episode_description']]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"id":"u7_Z0_Wxkcbw","executionInfo":{"status":"ok","timestamp":1650028105971,"user_tz":-60,"elapsed":21,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"e57720f7-0d6f-41fc-a88d-6cbe82d4a534"},"execution_count":8,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                                show_name  \\\n","0                                    Kream in your Koffee   \n","1                                   Morning Cup Of Murder   \n","2       Inside The 18 : A Podcast for Goalkeepers by G...   \n","3                                         Arrowhead Live!   \n","4                                                   FBoL    \n","...                                                   ...   \n","105355                                         The Top 10   \n","105356                          Let's Grab Coffee Podcast   \n","105357                                  Coach Corey Wayne   \n","105358                                The Cricket Podcast   \n","105359           Sleepyhead Stories - Mother/Daughter Duo   \n","\n","                                             episode_name  \\\n","0                                 1: It’s Christmas Time!   \n","1       The Goleta Postal Facility shootings- January ...   \n","2       Ep.36 - Incorporating a Singular Goalkeeping C...   \n","3                        Episode 1: Arrowhead Live! Debut   \n","4       The Lion, The Witch, And The Wardrobe - Ashley...   \n","...                                                   ...   \n","105355          The Top 10 - Re-List - Steve Martin Moves   \n","105356  Let's Grab Coffee E45 with Ross Paquette | Gro...   \n","105357                      Maybe She Is Just Testing Me?   \n","105358                           Ep 16: England In Danger   \n","105359         The Tale Of Little Pig Robinson 🐖 (part 2)   \n","\n","                                      episode_description  \n","0       On the first ever episode of Kream in your Kof...  \n","1       See something, say something. It’s a mantra ma...  \n","2       Today’s episode is a sit down Michael and Omar...  \n","3       Join us as we take a look at all current Chief...  \n","4       The modern morality tail of how to stay good f...  \n","...                                                   ...  \n","105355  Thanks to our patreon members for their suppor...  \n","105356  Ross founded Maropost in 2011 as a customer-ce...  \n","105357  How to know if your woman is maybe just testin...  \n","105358  In Episode 16, the boys evaluate England's per...  \n","105359  Little Pig Robinson finally makes it to the ma...  \n","\n","[105360 rows x 3 columns]"],"text/html":["\n","  <div id=\"df-1aba4166-4849-4e6d-83b7-9001240dd43a\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>show_name</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>Kream in your Koffee</td>\n","      <td>1: It’s Christmas Time!</td>\n","      <td>On the first ever episode of Kream in your Kof...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Morning Cup Of Murder</td>\n","      <td>The Goleta Postal Facility shootings- January ...</td>\n","      <td>See something, say something. It’s a mantra ma...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>Inside The 18 : A Podcast for Goalkeepers by G...</td>\n","      <td>Ep.36 - Incorporating a Singular Goalkeeping C...</td>\n","      <td>Today’s episode is a sit down Michael and Omar...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>Arrowhead Live!</td>\n","      <td>Episode 1: Arrowhead Live! Debut</td>\n","      <td>Join us as we take a look at all current Chief...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>FBoL</td>\n","      <td>The Lion, The Witch, And The Wardrobe - Ashley...</td>\n","      <td>The modern morality tail of how to stay good f...</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>105355</th>\n","      <td>The Top 10</td>\n","      <td>The Top 10 - Re-List - Steve Martin Moves</td>\n","      <td>Thanks to our patreon members for their suppor...</td>\n","    </tr>\n","    <tr>\n","      <th>105356</th>\n","      <td>Let's Grab Coffee Podcast</td>\n","      <td>Let's Grab Coffee E45 with Ross Paquette | Gro...</td>\n","      <td>Ross founded Maropost in 2011 as a customer-ce...</td>\n","    </tr>\n","    <tr>\n","      <th>105357</th>\n","      <td>Coach Corey Wayne</td>\n","      <td>Maybe She Is Just Testing Me?</td>\n","      <td>How to know if your woman is maybe just testin...</td>\n","    </tr>\n","    <tr>\n","      <th>105358</th>\n","      <td>The Cricket Podcast</td>\n","      <td>Ep 16: England In Danger</td>\n","      <td>In Episode 16, the boys evaluate England's per...</td>\n","    </tr>\n","    <tr>\n","      <th>105359</th>\n","      <td>Sleepyhead Stories - Mother/Daughter Duo</td>\n","      <td>The Tale Of Little Pig Robinson 🐖 (part 2)</td>\n","      <td>Little Pig Robinson finally makes it to the ma...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>105360 rows × 3 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1aba4166-4849-4e6d-83b7-9001240dd43a')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-1aba4166-4849-4e6d-83b7-9001240dd43a button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-1aba4166-4849-4e6d-83b7-9001240dd43a');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":8}]},{"cell_type":"markdown","metadata":{"id":"zn_QaTLLfoUV"},"source":["## Import TREC queries and qrels\n","The TREC podcast track queries and relevance judgements are used from task 1 (segment retrieval).\n","\n","Queries: we implement our search engine with both short/title queries and long/descriptive queries to compare the results.\n","\n","Relevance judgements: we assume that a relevant segment means the whole podcast episdoe is relevant to a query. For episodes which have multiple sections relevant to a query, we take the relevance judgement for the most relevant section as the score for the whole episode."]},{"cell_type":"markdown","metadata":{"id":"325EXNhgsxlp"},"source":["### Queries"]},{"cell_type":"code","execution_count":9,"metadata":{"id":"OTbRVnVZhuTE","executionInfo":{"status":"ok","timestamp":1650028106178,"user_tz":-60,"elapsed":225,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["from urllib.request import urlopen\n","from bs4 import BeautifulSoup"]},{"cell_type":"code","execution_count":10,"metadata":{"id":"tpj_qLjHgyKV","executionInfo":{"status":"ok","timestamp":1650028106180,"user_tz":-60,"elapsed":7,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["urls = [\"https://trecpodcasts.github.io/resources/podcasts_2020_topics_train.xml\",\n","        \"https://trecpodcasts.github.io/resources/podcasts_2020_topics_test.xml\"]"]},{"cell_type":"code","execution_count":11,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":496,"status":"ok","timestamp":1650028106671,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"CNcIFOwxZbIH","outputId":"88b4a9dc-a854-4e85-98a0-27273021a425"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["  num                          query        type  \\\n","0   1             coronavirus spread     topical   \n","1   2  greta thunberg cross atlantic     topical   \n","2   3               black hole image     topical   \n","3   4      story about riding a bird   refinding   \n","4   5            daniel ek interview  known item   \n","\n","                                         description  \n","0  What were people saying about the spread of th...  \n","1  What were people saying about Greta Thunberg’s...  \n","2  In May 2019 astronomers released the first-eve...  \n","3  I remember hearing a podcast that had a story ...  \n","4  Someone told me about a podcast interview with...  "],"text/html":["\n","  <div id=\"df-758b4b00-a1c4-4d2d-8168-b231d95ee6c0\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>num</th>\n","      <th>query</th>\n","      <th>type</th>\n","      <th>description</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>coronavirus spread</td>\n","      <td>topical</td>\n","      <td>What were people saying about the spread of th...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2</td>\n","      <td>greta thunberg cross atlantic</td>\n","      <td>topical</td>\n","      <td>What were people saying about Greta Thunberg’s...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>3</td>\n","      <td>black hole image</td>\n","      <td>topical</td>\n","      <td>In May 2019 astronomers released the first-eve...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4</td>\n","      <td>story about riding a bird</td>\n","      <td>refinding</td>\n","      <td>I remember hearing a podcast that had a story ...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>5</td>\n","      <td>daniel ek interview</td>\n","      <td>known item</td>\n","      <td>Someone told me about a podcast interview with...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-758b4b00-a1c4-4d2d-8168-b231d95ee6c0')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-758b4b00-a1c4-4d2d-8168-b231d95ee6c0 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-758b4b00-a1c4-4d2d-8168-b231d95ee6c0');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":11}],"source":["queries = pd.DataFrame()\n","for url in urls:\n","  html = urlopen(url)\n","  soup = BeautifulSoup(html, 'lxml')\n","  rows = soup.find_all('topic')\n","\n","  # Create dict with column headings and empty lists\n","  table_dict = {'num': [], 'query': [], 'type': [], 'description': []}\n","\n","  # For every row in the table, find each cell element and add it to the list\n","  for row in rows:\n","    for col in table_dict:\n","      cell = str(row.find_all(col))\n","      cell_cleantext = BeautifulSoup(cell, \"lxml\").get_text()  # extract the text without HTML tags\n","      table_dict[col].append(cell_cleantext)  # Add the clean table row to the list\n","\n","  table = pd.DataFrame(table_dict)\n","  for col in table_dict:\n","    table[col] = table[col].str.strip('[]')\n","\n","  queries = queries.append(table)\n","\n","queries[:5]"]},{"cell_type":"code","execution_count":12,"metadata":{"id":"teDzNIyh0kdv","executionInfo":{"status":"ok","timestamp":1650028106673,"user_tz":-60,"elapsed":32,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# remove queries 47 and 50 which have no QRels\n","queries = queries.drop(queries.index[queries['num'].isin(['47', '50'])]).reset_index(drop=True)"]},{"cell_type":"markdown","metadata":{"id":"JtijsAM_A-bn"},"source":["#### Format as PyTerrier Queries"]},{"cell_type":"code","execution_count":13,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":32,"status":"ok","timestamp":1650028106674,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"PifPaNov9fkR","outputId":"bc84e133-1da2-49c2-b05e-dffd54c1569e"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["  qid                          query\n","0   1             coronavirus spread\n","1   2  greta thunberg cross atlantic\n","2   3               black hole image\n","3   4      story about riding a bird\n","4   5            daniel ek interview"],"text/html":["\n","  <div id=\"df-79a1b2a4-94f8-4f24-9619-5e332b5b22d0\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>query</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>coronavirus spread</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2</td>\n","      <td>greta thunberg cross atlantic</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>3</td>\n","      <td>black hole image</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4</td>\n","      <td>story about riding a bird</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>5</td>\n","      <td>daniel ek interview</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-79a1b2a4-94f8-4f24-9619-5e332b5b22d0')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-79a1b2a4-94f8-4f24-9619-5e332b5b22d0 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-79a1b2a4-94f8-4f24-9619-5e332b5b22d0');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":13}],"source":["short_queries = queries[['num','query']]\n","short_queries = short_queries.rename(columns={'num':'qid'})\n","short_queries[:5]"]},{"cell_type":"code","execution_count":14,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":30,"status":"ok","timestamp":1650028106676,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"jxdT7aHQrk_g","outputId":"c5402825-ddf9-47bd-9cc3-bb0b2a6a69cf"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["  qid                                              query\n","0   1  What were people saying about the spread of th...\n","1   2  What were people saying about Greta Thunberg’s...\n","2   3  In May 2019 astronomers released the first-eve...\n","3   4  I remember hearing a podcast that had a story ...\n","4   5  Someone told me about a podcast interview with..."],"text/html":["\n","  <div id=\"df-15d3f79e-a050-4cb5-a6e8-7e0d4ffacfa5\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>query</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>What were people saying about the spread of th...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2</td>\n","      <td>What were people saying about Greta Thunberg’s...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>3</td>\n","      <td>In May 2019 astronomers released the first-eve...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4</td>\n","      <td>I remember hearing a podcast that had a story ...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>5</td>\n","      <td>Someone told me about a podcast interview with...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-15d3f79e-a050-4cb5-a6e8-7e0d4ffacfa5')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-15d3f79e-a050-4cb5-a6e8-7e0d4ffacfa5 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-15d3f79e-a050-4cb5-a6e8-7e0d4ffacfa5');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":14}],"source":["long_queries = queries[['num','description']]\n","long_queries = long_queries.rename(columns={'num':'qid', 'description':'query'})\n","long_queries[:5]"]},{"cell_type":"code","execution_count":15,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":31,"status":"ok","timestamp":1650028106679,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"6MgaRSOsoQJk","outputId":"89e8a48f-a371-4bea-cdb0-268a092fee0c"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["  qid                                              query\n","0   1  What were people saying about the spread of th...\n","1   2  What were people saying about Greta Thunbergs ...\n","2   3  In May 2019 astronomers released the firstever...\n","3   4  I remember hearing a podcast that had a story ...\n","4   5  Someone told me about a podcast interview with..."],"text/html":["\n","  <div id=\"df-093a2091-142d-4217-89e8-5470ff939e5d\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>query</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>What were people saying about the spread of th...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2</td>\n","      <td>What were people saying about Greta Thunbergs ...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>3</td>\n","      <td>In May 2019 astronomers released the firstever...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4</td>\n","      <td>I remember hearing a podcast that had a story ...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>5</td>\n","      <td>Someone told me about a podcast interview with...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-093a2091-142d-4217-89e8-5470ff939e5d')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-093a2091-142d-4217-89e8-5470ff939e5d button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-093a2091-142d-4217-89e8-5470ff939e5d');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":15}],"source":["# remove special characters from long queries - not done by query processor\n","import re\n","\n","def remove_special(row):\n","  return re.sub(r'[^a-zA-Z0-9 ]+', '', row.query)\n","\n","long_queries['query'] = long_queries.apply(remove_special, axis=1)\n","long_queries[:5]"]},{"cell_type":"markdown","metadata":{"id":"unfYE8eyspem"},"source":["### Relevance Judgements"]},{"cell_type":"code","execution_count":16,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":349,"status":"ok","timestamp":1650028106998,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"5vuL7-WjstqU","outputId":"a79ab309-e651-4675-f07a-7afcfda48b5e"},"outputs":[{"output_type":"stream","name":"stdout","text":["(609, 3)\n"]}],"source":["# import Podcast Track training set QRels\n","url = \"https://trecpodcasts.github.io/resources/2020_train_qrels.list\"\n","html = urlopen(url)\n","\n","qrel = pd.read_csv(html, sep='\\t', header=None)\n","qrel = qrel.drop(columns = 1).rename(columns = {0: 'query', 2: 'episode_uri', 3: 'relevance'})\n","print(qrel.shape)"]},{"cell_type":"code","execution_count":17,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":224},"executionInfo":{"elapsed":25,"status":"ok","timestamp":1650028107001,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"mWD1hdATWLnU","outputId":"01ba07e6-715a-4d1c-e544-06f8ea51c67a"},"outputs":[{"output_type":"stream","name":"stdout","text":["(10035, 3)\n"]},{"output_type":"execute_result","data":{"text/plain":["   query                                    episode_uri  relevance\n","0      1   spotify:episode:0E2nqCXMkS218SE72APmNr_240.0          2\n","1      1   spotify:episode:0E2nqCXMkS218SE72APmNr_300.0          2\n","2      1   spotify:episode:0E2nqCXMkS218SE72APmNr_360.0          2\n","3      1   spotify:episode:0Th494DvnO5dU8vTi3QHm2_120.0          1\n","4      1  spotify:episode:199bOiXL0l4YsRaSNDNXvP_1200.0          2"],"text/html":["\n","  <div id=\"df-85454bd8-9c8d-4bee-a626-6288dbc90d1c\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>query</th>\n","      <th>episode_uri</th>\n","      <th>relevance</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>spotify:episode:0E2nqCXMkS218SE72APmNr_240.0</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>spotify:episode:0E2nqCXMkS218SE72APmNr_300.0</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>1</td>\n","      <td>spotify:episode:0E2nqCXMkS218SE72APmNr_360.0</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1</td>\n","      <td>spotify:episode:0Th494DvnO5dU8vTi3QHm2_120.0</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1</td>\n","      <td>spotify:episode:199bOiXL0l4YsRaSNDNXvP_1200.0</td>\n","      <td>2</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-85454bd8-9c8d-4bee-a626-6288dbc90d1c')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-85454bd8-9c8d-4bee-a626-6288dbc90d1c button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-85454bd8-9c8d-4bee-a626-6288dbc90d1c');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":17}],"source":["# add Podcast Track 2020 test set QRels\n","url_test = \"https://trecpodcasts.github.io/resources/2020_test_qrels.list\"\n","html_test = urlopen(url_test)\n","\n","qrel_test = pd.read_csv(html_test, delim_whitespace=True, header=None)\n","qrel_test = qrel_test.drop(columns = 1).rename(columns = {0: 'query', 2: 'episode_uri', 3: 'relevance'})\n","qrel = qrel.append(qrel_test).reset_index(drop=True)\n","print(qrel.shape)\n","qrel[:5]"]},{"cell_type":"code","execution_count":18,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":22,"status":"ok","timestamp":1650028107002,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"8eKQTiUCsUBl","outputId":"d7a1745d-eeab-4505-9525-acc77b4c08b9"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["       query                             episode_uri  relevance\n","0          1  spotify:episode:0E2nqCXMkS218SE72APmNr          2\n","1          1  spotify:episode:0E2nqCXMkS218SE72APmNr          2\n","2          1  spotify:episode:0E2nqCXMkS218SE72APmNr          2\n","3          1  spotify:episode:0Th494DvnO5dU8vTi3QHm2          1\n","4          1  spotify:episode:199bOiXL0l4YsRaSNDNXvP          2\n","...      ...                                     ...        ...\n","10030     32  spotify:episode:7lrWzeepJQwhr0jyuVEk9m          0\n","10031     32  spotify:episode:7lrWzeepJQwhr0jyuVEk9m          0\n","10032     32  spotify:episode:7ok6wB1WviyXvxba0wdb5q          0\n","10033     32  spotify:episode:7ok6wB1WviyXvxba0wdb5q          0\n","10034     32  spotify:episode:7pRpADlrOriqKmWPR6CD3v          0\n","\n","[10035 rows x 3 columns]"],"text/html":["\n","  <div id=\"df-2b9be5ea-42fb-44b6-b01c-075726c48e18\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>query</th>\n","      <th>episode_uri</th>\n","      <th>relevance</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>spotify:episode:0E2nqCXMkS218SE72APmNr</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>spotify:episode:0E2nqCXMkS218SE72APmNr</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>1</td>\n","      <td>spotify:episode:0E2nqCXMkS218SE72APmNr</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1</td>\n","      <td>spotify:episode:0Th494DvnO5dU8vTi3QHm2</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1</td>\n","      <td>spotify:episode:199bOiXL0l4YsRaSNDNXvP</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>10030</th>\n","      <td>32</td>\n","      <td>spotify:episode:7lrWzeepJQwhr0jyuVEk9m</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>10031</th>\n","      <td>32</td>\n","      <td>spotify:episode:7lrWzeepJQwhr0jyuVEk9m</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>10032</th>\n","      <td>32</td>\n","      <td>spotify:episode:7ok6wB1WviyXvxba0wdb5q</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>10033</th>\n","      <td>32</td>\n","      <td>spotify:episode:7ok6wB1WviyXvxba0wdb5q</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>10034</th>\n","      <td>32</td>\n","      <td>spotify:episode:7pRpADlrOriqKmWPR6CD3v</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>10035 rows × 3 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-2b9be5ea-42fb-44b6-b01c-075726c48e18')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-2b9be5ea-42fb-44b6-b01c-075726c48e18 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-2b9be5ea-42fb-44b6-b01c-075726c48e18');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":18}],"source":["# Removing the time marker from episode_uri in qrels\n","qrel['episode_uri'] = qrel['episode_uri'].str.split('_').str[0]\n","qrel"]},{"cell_type":"code","execution_count":19,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":22,"status":"ok","timestamp":1650028107003,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"o61lyMMRgNu7","outputId":"23837b58-0822-42bc-e73f-398a8a872925"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["      query                             episode_uri  relevance\n","0         1  spotify:episode:199bOiXL0l4YsRaSNDNXvP          2\n","1         1  spotify:episode:3tjC7pqnSnH6CKgikJc6kz          1\n","2         1  spotify:episode:5GoN5um5iK3sAASmrFm6O3          1\n","3         1  spotify:episode:6NFE7Hc6BSKxyYwLP0tU7e          2\n","4         1  spotify:episode:6yjL01GPLvFmZkOgi2wOdo          1\n","...     ...                                     ...        ...\n","5825     58  spotify:episode:4QCDMI9JReYNxNZeoSgTRP          0\n","5826     58  spotify:episode:2ORbRWSwWFYTAaoF0koZTW          0\n","5827     58  spotify:episode:2M6NzBfj3laFN7x44v8wiz          0\n","5828     58  spotify:episode:5VtYE9t7kagCTY05sF47jl          0\n","5829     58  spotify:episode:4lHWbstJTZG1X6ql16rpqB          0\n","\n","[5830 rows x 3 columns]"],"text/html":["\n","  <div id=\"df-7064a91e-d207-447e-b625-f42c12183c99\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>query</th>\n","      <th>episode_uri</th>\n","      <th>relevance</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>spotify:episode:199bOiXL0l4YsRaSNDNXvP</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>spotify:episode:3tjC7pqnSnH6CKgikJc6kz</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>1</td>\n","      <td>spotify:episode:5GoN5um5iK3sAASmrFm6O3</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1</td>\n","      <td>spotify:episode:6NFE7Hc6BSKxyYwLP0tU7e</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1</td>\n","      <td>spotify:episode:6yjL01GPLvFmZkOgi2wOdo</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>5825</th>\n","      <td>58</td>\n","      <td>spotify:episode:4QCDMI9JReYNxNZeoSgTRP</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5826</th>\n","      <td>58</td>\n","      <td>spotify:episode:2ORbRWSwWFYTAaoF0koZTW</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5827</th>\n","      <td>58</td>\n","      <td>spotify:episode:2M6NzBfj3laFN7x44v8wiz</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5828</th>\n","      <td>58</td>\n","      <td>spotify:episode:5VtYE9t7kagCTY05sF47jl</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5829</th>\n","      <td>58</td>\n","      <td>spotify:episode:4lHWbstJTZG1X6ql16rpqB</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>5830 rows × 3 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-7064a91e-d207-447e-b625-f42c12183c99')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-7064a91e-d207-447e-b625-f42c12183c99 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-7064a91e-d207-447e-b625-f42c12183c99');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":19}],"source":["# take the highest relevance score for each query-episode pair (a single episode\n","# may have multiple sections judged as relevant to the same query, so we take\n","# the relevance judgement for the most relevant section)\n","qrel = qrel.sort_values(by=['relevance']).drop_duplicates(subset=['query', 'episode_uri'], keep='last')\n","qrel = qrel.sort_values(by=['query']).reset_index(drop=True)\n","qrel"]},{"cell_type":"markdown","metadata":{"id":"Pt-504Sr0_4t"},"source":["#### Remove QRels for Episodes without Descriptions"]},{"cell_type":"code","execution_count":20,"metadata":{"id":"LCkR1HkQs7AP","executionInfo":{"status":"ok","timestamp":1650028107193,"user_tz":-60,"elapsed":210,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# find all episodes present in qrels\n","in_qrels = metadf.loc[metadf.episode_uri.isin(qrel.episode_uri.unique())]"]},{"cell_type":"code","execution_count":21,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":11,"status":"ok","timestamp":1650028107194,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"pzb8ilN81OW1","outputId":"7881d482-891c-4617-e263-857822653a0e"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["Int64Index([], dtype='int64')"]},"metadata":{},"execution_count":21}],"source":["# check NaN entries\n","in_qrels.index[in_qrels.episode_description.isnull()]"]},{"cell_type":"code","execution_count":22,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8,"status":"ok","timestamp":1650028107194,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"5kVa0lqC1MP5","outputId":"0da4cf0e-83a5-4fb2-8f94-b8e0904569ca"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["Int64Index([], dtype='int64')"]},"metadata":{},"execution_count":22}],"source":["# check for empty strings\n","in_qrels.index[in_qrels.episode_description == '']"]},{"cell_type":"code","execution_count":23,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":250,"status":"ok","timestamp":1650028107439,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"6EuA-yIGw_v7","outputId":"03df57af-8f42-4b03-b113-cdaee3fd5c72"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["[3972, 101227]"]},"metadata":{},"execution_count":23}],"source":["# check for one word descriptions\n","import re\n","def one_word(row):\n","    return re.search(r'.*\\s', row.episode_description)\n","\n","one_word_descr = list(in_qrels.index[in_qrels.apply(one_word, axis=1).isna()])\n","one_word_descr"]},{"cell_type":"code","execution_count":24,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":10,"status":"ok","timestamp":1650028107440,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"wGaiZ68yxMX_","outputId":"2a5b5537-090c-4e5e-e8d6-0c981b423897"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["(5828, 3)"]},"metadata":{},"execution_count":24}],"source":["# remove QRels with one word episode description\n","# both episodes have description 'nan'\n","qrel = qrel.drop(qrel.index[qrel.episode_uri.isin(in_qrels.episode_uri[in_qrels.index.isin(one_word_descr)])]).reset_index(drop=True)\n","qrel.shape"]},{"cell_type":"markdown","metadata":{"id":"E1XDJ2GTAhMq"},"source":["#### Format as PyTerrier QRels"]},{"cell_type":"code","execution_count":25,"metadata":{"id":"z6H5Wf1f7UI0","executionInfo":{"status":"ok","timestamp":1650028116197,"user_tz":-60,"elapsed":8764,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# create dict {episode_uri: doc}\n","docno_dict = metadf.loc[:,['episode_uri', 'docno']].set_index('episode_uri').T.to_dict('list')"]},{"cell_type":"code","execution_count":26,"metadata":{"id":"dW-D8Stv7UI0","executionInfo":{"status":"ok","timestamp":1650028116205,"user_tz":-60,"elapsed":52,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# insert docno for each episode_uri in qrels using dict\n","def get_docno(row):\n","  doc_number = docno_dict[row]\n","  return doc_number[0]\n","\n","qrel.episode_uri = qrel.episode_uri.apply(get_docno)"]},{"cell_type":"code","execution_count":27,"metadata":{"id":"XSsyz-rJ7UI2","executionInfo":{"status":"ok","timestamp":1650028116211,"user_tz":-60,"elapsed":56,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# rename columns and change data types to make qrels compatible with PyTerrier\n","qrel = qrel.rename(columns={'query':'qid', 'episode_uri':'docno', 'relevance':'label'})\n","qrel['qid'] = qrel['qid'].apply(str)\n","#qrel.dtypes"]},{"cell_type":"code","execution_count":28,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"executionInfo":{"elapsed":57,"status":"ok","timestamp":1650028116213,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"},"user_tz":-60},"id":"TmGorDt87UI3","outputId":"27235d1d-58f4-41f5-f641-2f09fbfa68d8"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["     qid  docno  label\n","0      1  15551      2\n","1      1  53215      1\n","2      1  71582      1\n","3      1  86350      2\n","4      1  94450      1\n","...   ..    ...    ...\n","5823  58  60156      0\n","5824  58  32607      0\n","5825  58  32081      0\n","5826  58  74811      0\n","5827  58  64692      0\n","\n","[5828 rows x 3 columns]"],"text/html":["\n","  <div id=\"df-ead08f4c-f3ca-44d0-a78e-21e4ff5d82f9\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>docno</th>\n","      <th>label</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>15551</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>53215</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>1</td>\n","      <td>71582</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1</td>\n","      <td>86350</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1</td>\n","      <td>94450</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>5823</th>\n","      <td>58</td>\n","      <td>60156</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5824</th>\n","      <td>58</td>\n","      <td>32607</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5825</th>\n","      <td>58</td>\n","      <td>32081</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5826</th>\n","      <td>58</td>\n","      <td>74811</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5827</th>\n","      <td>58</td>\n","      <td>64692</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>5828 rows × 3 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-ead08f4c-f3ca-44d0-a78e-21e4ff5d82f9')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-ead08f4c-f3ca-44d0-a78e-21e4ff5d82f9 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-ead08f4c-f3ca-44d0-a78e-21e4ff5d82f9');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":28}],"source":["qrel"]},{"cell_type":"markdown","source":["## Demo Starts Here"],"metadata":{"id":"vP8uiWtt2Tb0"}},{"cell_type":"code","source":["# dataset\n","metadf[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":337},"id":"JlL7tqTX2Vgs","executionInfo":{"status":"ok","timestamp":1650028116215,"user_tz":-60,"elapsed":57,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"fff7c2df-0867-40cc-a59e-c5e03dff564d"},"execution_count":29,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                              episode_uri  \\\n","0  spotify:episode:000A9sRBYdVh66csG2qEdj   \n","1  spotify:episode:000HP8n3hNIfglT2wSI2cA   \n","2  spotify:episode:001UfOruzkA3Bn1SPjcdfa   \n","3  spotify:episode:001i89SvIQgDuuyC53hfBm   \n","4  spotify:episode:0025RWNwe2lnp6HcnfzwzG   \n","\n","                                           show_name  \\\n","0                               Kream in your Koffee   \n","1                              Morning Cup Of Murder   \n","2  Inside The 18 : A Podcast for Goalkeepers by G...   \n","3                                    Arrowhead Live!   \n","4                                              FBoL    \n","\n","                                    show_description  \\\n","0  A 20-something blunt female takes on the world...   \n","1  Ever wonder what murder took place on today in...   \n","2  Inside the 18 is your source for all things Go...   \n","3  Your favorite podcast for everything @Chiefs! ...   \n","4  The comedy podcast about toxic characters, wri...   \n","\n","                                        episode_name  \\\n","0                            1: It’s Christmas Time!   \n","1  The Goleta Postal Facility shootings- January ...   \n","2  Ep.36 - Incorporating a Singular Goalkeeping C...   \n","3                   Episode 1: Arrowhead Live! Debut   \n","4  The Lion, The Witch, And The Wardrobe - Ashley...   \n","\n","                                 episode_description docno  \n","0  On the first ever episode of Kream in your Kof...     0  \n","1  See something, say something. It’s a mantra ma...     1  \n","2  Today’s episode is a sit down Michael and Omar...     2  \n","3  Join us as we take a look at all current Chief...     3  \n","4  The modern morality tail of how to stay good f...     4  "],"text/html":["\n","  <div id=\"df-fe208118-e218-436d-a403-c8f7d2c43c9c\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>episode_uri</th>\n","      <th>show_name</th>\n","      <th>show_description</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","      <th>docno</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>spotify:episode:000A9sRBYdVh66csG2qEdj</td>\n","      <td>Kream in your Koffee</td>\n","      <td>A 20-something blunt female takes on the world...</td>\n","      <td>1: It’s Christmas Time!</td>\n","      <td>On the first ever episode of Kream in your Kof...</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>spotify:episode:000HP8n3hNIfglT2wSI2cA</td>\n","      <td>Morning Cup Of Murder</td>\n","      <td>Ever wonder what murder took place on today in...</td>\n","      <td>The Goleta Postal Facility shootings- January ...</td>\n","      <td>See something, say something. It’s a mantra ma...</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>spotify:episode:001UfOruzkA3Bn1SPjcdfa</td>\n","      <td>Inside The 18 : A Podcast for Goalkeepers by G...</td>\n","      <td>Inside the 18 is your source for all things Go...</td>\n","      <td>Ep.36 - Incorporating a Singular Goalkeeping C...</td>\n","      <td>Today’s episode is a sit down Michael and Omar...</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>spotify:episode:001i89SvIQgDuuyC53hfBm</td>\n","      <td>Arrowhead Live!</td>\n","      <td>Your favorite podcast for everything @Chiefs! ...</td>\n","      <td>Episode 1: Arrowhead Live! Debut</td>\n","      <td>Join us as we take a look at all current Chief...</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>spotify:episode:0025RWNwe2lnp6HcnfzwzG</td>\n","      <td>FBoL</td>\n","      <td>The comedy podcast about toxic characters, wri...</td>\n","      <td>The Lion, The Witch, And The Wardrobe - Ashley...</td>\n","      <td>The modern morality tail of how to stay good f...</td>\n","      <td>4</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-fe208118-e218-436d-a403-c8f7d2c43c9c')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-fe208118-e218-436d-a403-c8f7d2c43c9c button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-fe208118-e218-436d-a403-c8f7d2c43c9c');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":29}]},{"cell_type":"code","source":["# short/title queries\n","short_queries[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"2CRiXVzW2VlM","executionInfo":{"status":"ok","timestamp":1650028116218,"user_tz":-60,"elapsed":59,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"2536d407-ef02-418b-ea4b-579e59a23660"},"execution_count":30,"outputs":[{"output_type":"execute_result","data":{"text/plain":["  qid                          query\n","0   1             coronavirus spread\n","1   2  greta thunberg cross atlantic\n","2   3               black hole image\n","3   4      story about riding a bird\n","4   5            daniel ek interview"],"text/html":["\n","  <div id=\"df-04e44ce9-c989-47f7-bd4f-2fdf797bf39b\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>query</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>coronavirus spread</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2</td>\n","      <td>greta thunberg cross atlantic</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>3</td>\n","      <td>black hole image</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4</td>\n","      <td>story about riding a bird</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>5</td>\n","      <td>daniel ek interview</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-04e44ce9-c989-47f7-bd4f-2fdf797bf39b')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-04e44ce9-c989-47f7-bd4f-2fdf797bf39b button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-04e44ce9-c989-47f7-bd4f-2fdf797bf39b');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":30}]},{"cell_type":"code","source":["# long/descriptive queries\n","pd.options.display.max_colwidth = 200\n","long_queries[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"rJh6_lL42VrI","executionInfo":{"status":"ok","timestamp":1650028116223,"user_tz":-60,"elapsed":62,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"0109c3e8-68f9-4a09-d1d6-2f946df3da19"},"execution_count":31,"outputs":[{"output_type":"execute_result","data":{"text/plain":["  qid  \\\n","0   1   \n","1   2   \n","2   3   \n","3   4   \n","4   5   \n","\n","                                                                                                                                                                                                     query  \n","0                                                                                                     What were people saying about the spread of the novel coronavirus NCOV19 in Wuhan at the end of 2019  \n","1                                                   What were people saying about Greta Thunbergs sailing trip across the Atlantic Ocean in the fall of 2019 and its relationship to global climate change  \n","2  In May 2019 astronomers released the firstever picture of a black hole I would like to hear some conversations and educational discussion about the science of astronomy black holes and of the pict...  \n","3                                                                                               I remember hearing a podcast that had a story about a kid riding some kind of bird I want to find it again  \n","4  Someone told me about a podcast interview with Daniel Ek CEO of Spotify about the founding and early days of Spotify I would like to find the show and episode that contains that interview Other in...  "],"text/html":["\n","  <div id=\"df-043adfdc-ae4c-493a-adda-e6e761ffaa7b\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>query</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>What were people saying about the spread of the novel coronavirus NCOV19 in Wuhan at the end of 2019</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2</td>\n","      <td>What were people saying about Greta Thunbergs sailing trip across the Atlantic Ocean in the fall of 2019 and its relationship to global climate change</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>3</td>\n","      <td>In May 2019 astronomers released the firstever picture of a black hole I would like to hear some conversations and educational discussion about the science of astronomy black holes and of the pict...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>4</td>\n","      <td>I remember hearing a podcast that had a story about a kid riding some kind of bird I want to find it again</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>5</td>\n","      <td>Someone told me about a podcast interview with Daniel Ek CEO of Spotify about the founding and early days of Spotify I would like to find the show and episode that contains that interview Other in...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-043adfdc-ae4c-493a-adda-e6e761ffaa7b')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-043adfdc-ae4c-493a-adda-e6e761ffaa7b button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-043adfdc-ae4c-493a-adda-e6e761ffaa7b');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":31}]},{"cell_type":"code","source":["# relevance judgements - altered from original Podcast Track\n","pd.options.display.max_colwidth = 50\n","qrel[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"syqQBkCs2cdx","executionInfo":{"status":"ok","timestamp":1650028116442,"user_tz":-60,"elapsed":14,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"5b6b6b54-772e-42fe-a26a-7308fe0005e3"},"execution_count":32,"outputs":[{"output_type":"execute_result","data":{"text/plain":["  qid  docno  label\n","0   1  15551      2\n","1   1  53215      1\n","2   1  71582      1\n","3   1  86350      2\n","4   1  94450      1"],"text/html":["\n","  <div id=\"df-e92c17fa-1750-4fad-a012-0daa94551c8c\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>docno</th>\n","      <th>label</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1</td>\n","      <td>15551</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>53215</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>1</td>\n","      <td>71582</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>1</td>\n","      <td>86350</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>1</td>\n","      <td>94450</td>\n","      <td>1</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e92c17fa-1750-4fad-a012-0daa94551c8c')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-e92c17fa-1750-4fad-a012-0daa94551c8c button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-e92c17fa-1750-4fad-a012-0daa94551c8c');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":32}]},{"cell_type":"markdown","source":["## Indexing"],"metadata":{"id":"EkHkTg7o2BdL"}},{"cell_type":"code","execution_count":null,"metadata":{"id":"rKZVe6SXkEvc"},"outputs":[],"source":["# Installing PyTerrier\n","!pip install python-terrier"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"YICfkPYfd_21"},"outputs":[],"source":["import pyterrier as pt\n","import numpy as np\n","import pandas as pd\n","if not pt.started():\n","   pt.init()"]},{"cell_type":"code","execution_count":35,"metadata":{"id":"wAx1aL29dHOS","executionInfo":{"status":"ok","timestamp":1650028149514,"user_tz":-60,"elapsed":549,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["!rm -rf ./pd_index\n","pd_indexer = pt.DFIndexer(\"./pd_index\")"]},{"cell_type":"code","execution_count":36,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"r7rbGSisWM9e","outputId":"c3467f28-0e67-4782-937c-ee72399ca700","executionInfo":{"status":"ok","timestamp":1650028241704,"user_tz":-60,"elapsed":92192,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["13:08:18.883 [main] WARN org.terrier.structures.indexing.Indexer - Adding an empty document to the index (5) - further warnings are suppressed\n","13:09:44.873 [main] WARN org.terrier.structures.indexing.Indexer - Indexed 255 empty documents\n"]}],"source":["# index metadata using classical indexing\n","index = pd_indexer.index(metadf[\"episode_description\"], metadf[\"docno\"])   # adds index null for episodes with no description"]},{"cell_type":"markdown","metadata":{"id":"WG00MSUDMTBs"},"source":["### Example Document Index\n","The code in this section was adapted from PyTerrier documentation - https://pyterrier.readthedocs.io/en/latest/terrier-index-api.html"]},{"cell_type":"code","execution_count":37,"metadata":{"id":"Sr5znscqKVag","executionInfo":{"status":"ok","timestamp":1650028241705,"user_tz":-60,"elapsed":8,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# access stored PyTerrier index\n","index_file = pt.IndexFactory.of(index)"]},{"cell_type":"code","execution_count":38,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Zy4NoRl1POVV","outputId":"96e3cce0-3bce-44fd-8794-9bbf28afb553","executionInfo":{"status":"ok","timestamp":1650028242433,"user_tz":-60,"elapsed":734,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Number of documents: 105360\n","Number of terms: 131456\n","Number of postings: 4124038\n","Number of fields: 0\n","Number of tokens: 5453411\n","Field names: []\n","Positions:   false\n","\n"]}],"source":["# view collection stats\n","print(index_file.getCollectionStatistics())"]},{"cell_type":"code","execution_count":67,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":498},"id":"eQCIGeZLMEzs","outputId":"2692fc28-8668-41a9-e167-3b5ca7b30989","executionInfo":{"status":"ok","timestamp":1650029196360,"user_tz":-60,"elapsed":450,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["show name: The Feminization Boudoir\n","episode name: The Sissy's Mentor (Part 5)\n","episode description: Miss Jenn Davis reads the final part of The Sissy's Mentor.  It's the story of a young inexperienced college freshman and the dominant woman who takes him under her wing or is that wig?   You can find a lot more great erotic content from Jenn at MissJennDavis.com. Remember that this podcast plays clips (Usually 40%-50%) from audios.  At least half the show is missing and in that half are the very sexiest parts. Please support Candy Apple Press at our clipsites: IWantClips Clips4Sale and buy our books: Amazon.com You can also donate to the Podcast directly at Anchor.fm.  Wherever you listen, please give us good feedback. Thanks, Kylie  ---   This episode is sponsored by  · Anchor: The easiest way to make a podcast.  https://anchor.fm/app  Support this podcast: https://anchor.fm/kylie-gable/support\n"]},{"output_type":"execute_result","data":{"text/plain":["         Term Frequency\n","0      episod         1\n","1         who         1\n","2          fm         3\n","3        http         2\n","4        show         1\n","..        ...       ...\n","58    sexiest         1\n","59      sissi         1\n","60  clips4sal         1\n","61  iwantclip         1\n","62       half         2\n","\n","[63 rows x 2 columns]"],"text/html":["\n","  <div id=\"df-b063ffd1-aaca-4e64-a0e6-0e944ca6e213\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Term</th>\n","      <th>Frequency</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>episod</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>who</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>fm</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>http</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>show</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>58</th>\n","      <td>sexiest</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>59</th>\n","      <td>sissi</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>60</th>\n","      <td>clips4sal</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>61</th>\n","      <td>iwantclip</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>62</th>\n","      <td>half</td>\n","      <td>2</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>63 rows × 2 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b063ffd1-aaca-4e64-a0e6-0e944ca6e213')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-b063ffd1-aaca-4e64-a0e6-0e944ca6e213 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-b063ffd1-aaca-4e64-a0e6-0e944ca6e213');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":67}],"source":["# single document index\n","docid = 6 #docids are 0-based\n","\n","di = index_file.getDirectIndex()\n","doi = index_file.getDocumentIndex()\n","lex = index_file.getLexicon()\n","\n","example_index = pd.DataFrame(columns=['Term','Frequency'])\n","#NB: postings will be null if the document is empty\n","for posting in di.getPostings(doi.getDocumentEntry(docid)):\n","    termid = posting.getId()\n","    lee = lex.getLexiconEntry(termid)\n","    term_freq = pd.DataFrame([[str(lee.getKey()), str(posting.getFrequency())]], columns=['Term', 'Frequency'])\n","    example_index = example_index.append(term_freq)\n","    #print(\"%s with frequency %d\" % (lee.getKey(),posting.getFrequency()))\n","\n","example_index = example_index.reset_index(drop=True)\n","print('show name: %s' % metadf.loc[metadf.docno == str(docid)].show_name.values[0])\n","print('episode name: %s' % metadf.loc[metadf.docno == str(docid)].episode_name.values[0])\n","print('episode description: %s' % metadf.loc[metadf.docno == str(docid)].episode_description.values[0])\n","example_index"]},{"cell_type":"markdown","metadata":{"id":"uf4GEUL_JVas"},"source":["## Experiment\n","Create battery of PyTerrier models to assess the performance of each on short and long queries."]},{"cell_type":"code","execution_count":40,"metadata":{"id":"A5eyIzpQr8mJ","executionInfo":{"status":"ok","timestamp":1650028244961,"user_tz":-60,"elapsed":2534,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["tfidf = pt.BatchRetrieve(index, wmodel='TF_IDF')\n","bm25 = pt.BatchRetrieve(index, wmodel='BM25')\n","bb2 = pt.BatchRetrieve(index, wmodel='BB2')\n","ifb2 = pt.BatchRetrieve(index, wmodel='IFB2')\n","lgd = pt.BatchRetrieve(index, wmodel='LGD')\n","dfrbm25 = pt.BatchRetrieve(index, wmodel='DFR_BM25')\n","dfreeklim = pt.BatchRetrieve(index, wmodel='DFReeKLIM')\n","dlh13 = pt.BatchRetrieve(index, wmodel='DLH13')\n","dfiz = pt.BatchRetrieve(index, wmodel='DFIZ')\n","dlh = pt.BatchRetrieve(index, wmodel='DLH')\n","dfic = pt.BatchRetrieve(index, wmodel='DFIC')\n","dfree = pt.BatchRetrieve(index, wmodel='DFRee')\n","dph = pt.BatchRetrieve(index, wmodel='DPH')\n","bm25f = pt.BatchRetrieve(index, wmodel='BM25F')\n","cm = pt.BatchRetrieve(index, wmodel='CoordinateMatch')\n","dplm = pt.BatchRetrieve(index, wmodel='DirichletLM')\n","hlm = pt.BatchRetrieve(index, wmodel='Hiemstra_LM')\n","ixb2 = pt.BatchRetrieve(index, wmodel='In_expB2')\n","ixc2 = pt.BatchRetrieve(index, wmodel='In_expC2')\n","inb2 = pt.BatchRetrieve(index, wmodel='InB2')\n","inl2 = pt.BatchRetrieve(index, wmodel='InL2')\n","jkl = pt.BatchRetrieve(index, wmodel='Js_KLs')\n","ltfidf = pt.BatchRetrieve(index, wmodel='LemurTF_IDF')\n","mdl2 = pt.BatchRetrieve(index, wmodel='MDL2')\n","ml2 = pt.BatchRetrieve(index, wmodel='ML2')\n","pl2 = pt.BatchRetrieve(index, wmodel='PL2')\n","pl2f = pt.BatchRetrieve(index, wmodel='PL2F')\n","tf = pt.BatchRetrieve(index, wmodel='Tf')\n","xsam = pt.BatchRetrieve(index, wmodel='XSqrA_M')"]},{"cell_type":"code","source":["# short queries\n","exp_df = pt.Experiment(\n","        [tfidf,bb2,ifb2,lgd,bm25,dfrbm25,dfreeklim,dlh13,dfiz,dlh,dfic,dfree,dph,cm,dplm,hlm,ixb2,ixc2,inb2,inl2,jkl,ltfidf,pl2,tf,xsam],\n","        short_queries,\n","        qrel,\n","        eval_metrics=['map', 'ndcg', 'recip_rank', 'mrt', 'recall'],\n","        names=['TF_IDF','BB2','IFB2','LGD','BM25','DFR-BM25','DFReeKLIM','DLH13','DFIZ','DLH','DFIC','DFRee','DPH','CM','DPLM','HLM','In_expB2','In_expC2','InB2','InL2','Js_KLs','LemurTF_IDF','PL2','TF','XSqrA_M'])\n","exp_df.sort_values(by=['map'], ascending=False)[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"jXO1TvDa0SR3","executionInfo":{"status":"ok","timestamp":1650028287942,"user_tz":-60,"elapsed":42985,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"3acced3d-a665-4cef-8e45-287f37516d08"},"execution_count":41,"outputs":[{"output_type":"execute_result","data":{"text/plain":["         name       map      ndcg  recip_rank       R@5      R@10      R@15  \\\n","6   DFReeKLIM  0.144115  0.307799    0.560486  0.141884  0.171833  0.191268   \n","7       DLH13  0.143085  0.304858    0.575151  0.133851  0.171794  0.195675   \n","8        DFIZ  0.142585  0.305012    0.556977  0.134556  0.174026  0.193468   \n","9         DLH  0.142503  0.306702    0.573405  0.137041  0.178791  0.198845   \n","12        DPH  0.141877  0.303974    0.568029  0.119813  0.159558  0.187713   \n","\n","        R@20      R@30     R@100     R@200     R@500    R@1000        mrt  \n","6   0.204515  0.221255  0.296788  0.323769  0.366047  0.389095  26.617622  \n","7   0.206217  0.228987  0.294781  0.320229  0.362960  0.379030  24.996611  \n","8   0.208189  0.228571  0.296880  0.323189  0.363549  0.384119  27.521918  \n","9   0.208620  0.228413  0.294701  0.321523  0.362375  0.380006  22.962932  \n","12  0.203326  0.222546  0.285827  0.320143  0.360501  0.386292  24.010577  "],"text/html":["\n","  <div id=\"df-be1ba8d8-0021-42aa-ad4d-c93929d16b19\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","      <th>recip_rank</th>\n","      <th>R@5</th>\n","      <th>R@10</th>\n","      <th>R@15</th>\n","      <th>R@20</th>\n","      <th>R@30</th>\n","      <th>R@100</th>\n","      <th>R@200</th>\n","      <th>R@500</th>\n","      <th>R@1000</th>\n","      <th>mrt</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>6</th>\n","      <td>DFReeKLIM</td>\n","      <td>0.144115</td>\n","      <td>0.307799</td>\n","      <td>0.560486</td>\n","      <td>0.141884</td>\n","      <td>0.171833</td>\n","      <td>0.191268</td>\n","      <td>0.204515</td>\n","      <td>0.221255</td>\n","      <td>0.296788</td>\n","      <td>0.323769</td>\n","      <td>0.366047</td>\n","      <td>0.389095</td>\n","      <td>26.617622</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>DLH13</td>\n","      <td>0.143085</td>\n","      <td>0.304858</td>\n","      <td>0.575151</td>\n","      <td>0.133851</td>\n","      <td>0.171794</td>\n","      <td>0.195675</td>\n","      <td>0.206217</td>\n","      <td>0.228987</td>\n","      <td>0.294781</td>\n","      <td>0.320229</td>\n","      <td>0.362960</td>\n","      <td>0.379030</td>\n","      <td>24.996611</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>DFIZ</td>\n","      <td>0.142585</td>\n","      <td>0.305012</td>\n","      <td>0.556977</td>\n","      <td>0.134556</td>\n","      <td>0.174026</td>\n","      <td>0.193468</td>\n","      <td>0.208189</td>\n","      <td>0.228571</td>\n","      <td>0.296880</td>\n","      <td>0.323189</td>\n","      <td>0.363549</td>\n","      <td>0.384119</td>\n","      <td>27.521918</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>DLH</td>\n","      <td>0.142503</td>\n","      <td>0.306702</td>\n","      <td>0.573405</td>\n","      <td>0.137041</td>\n","      <td>0.178791</td>\n","      <td>0.198845</td>\n","      <td>0.208620</td>\n","      <td>0.228413</td>\n","      <td>0.294701</td>\n","      <td>0.321523</td>\n","      <td>0.362375</td>\n","      <td>0.380006</td>\n","      <td>22.962932</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>DPH</td>\n","      <td>0.141877</td>\n","      <td>0.303974</td>\n","      <td>0.568029</td>\n","      <td>0.119813</td>\n","      <td>0.159558</td>\n","      <td>0.187713</td>\n","      <td>0.203326</td>\n","      <td>0.222546</td>\n","      <td>0.285827</td>\n","      <td>0.320143</td>\n","      <td>0.360501</td>\n","      <td>0.386292</td>\n","      <td>24.010577</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-be1ba8d8-0021-42aa-ad4d-c93929d16b19')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-be1ba8d8-0021-42aa-ad4d-c93929d16b19 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-be1ba8d8-0021-42aa-ad4d-c93929d16b19');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":41}]},{"cell_type":"code","source":["# long queries\n","exp_df = pt.Experiment(\n","        [tfidf,bb2,ifb2,lgd,bm25,dfrbm25,dfreeklim,dlh13,dfiz,dlh,dfic,dfree,dph,cm,dplm,hlm,ixb2,ixc2,inb2,inl2,jkl,ltfidf,pl2,tf,xsam],\n","        long_queries,\n","        qrel,\n","        eval_metrics=['map', 'ndcg', 'recip_rank', 'recall', 'mrt'],\n","        names=['TF_IDF','BB2','IFB2','LGD','BM25','DFR-BM25','DFReeKLIM','DLH13','DFIZ','DLH','DFIC','DFRee','DPH','CM','DPLM','HLM','In_expB2','In_expC2','InB2','InL2','Js_KLs','LemurTF_IDF','PL2','TF','XSqrA_M'])\n","exp_df.sort_values(by=['map'], ascending=False)[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"id":"mxPTEzvzdgHk","executionInfo":{"status":"ok","timestamp":1650028366313,"user_tz":-60,"elapsed":78376,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"eb99a81d-df10-447d-ff49-55e73ee48184"},"execution_count":42,"outputs":[{"output_type":"execute_result","data":{"text/plain":["           name       map      ndcg  recip_rank       R@5      R@10      R@15  \\\n","21  LemurTF_IDF  0.143051  0.308765    0.478289  0.132467  0.164426  0.181575   \n","14         DPLM  0.140566  0.285412    0.440988  0.134221  0.154193  0.178460   \n","15          HLM  0.138605  0.294424    0.474125  0.131814  0.165584  0.187996   \n","2          IFB2  0.137638  0.303295    0.532694  0.139675  0.167998  0.187384   \n","16     In_expB2  0.135536  0.301087    0.515228  0.139675  0.169487  0.186743   \n","\n","        R@20      R@30     R@100     R@200     R@500    R@1000        mrt  \n","21  0.193344  0.211448  0.283432  0.324015  0.375863  0.409305  49.862842  \n","14  0.189183  0.210886  0.260803  0.305724  0.356081  0.382678  52.342318  \n","15  0.202900  0.216252  0.258028  0.306399  0.353465  0.393399  49.973833  \n","2   0.195368  0.210227  0.278325  0.310714  0.365132  0.399227  50.722557  \n","16  0.194783  0.208927  0.272726  0.309903  0.365474  0.399571  59.862394  "],"text/html":["\n","  <div id=\"df-e516e95b-7b8c-4cf1-9e1c-f872c745af2a\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","      <th>recip_rank</th>\n","      <th>R@5</th>\n","      <th>R@10</th>\n","      <th>R@15</th>\n","      <th>R@20</th>\n","      <th>R@30</th>\n","      <th>R@100</th>\n","      <th>R@200</th>\n","      <th>R@500</th>\n","      <th>R@1000</th>\n","      <th>mrt</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>21</th>\n","      <td>LemurTF_IDF</td>\n","      <td>0.143051</td>\n","      <td>0.308765</td>\n","      <td>0.478289</td>\n","      <td>0.132467</td>\n","      <td>0.164426</td>\n","      <td>0.181575</td>\n","      <td>0.193344</td>\n","      <td>0.211448</td>\n","      <td>0.283432</td>\n","      <td>0.324015</td>\n","      <td>0.375863</td>\n","      <td>0.409305</td>\n","      <td>49.862842</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>DPLM</td>\n","      <td>0.140566</td>\n","      <td>0.285412</td>\n","      <td>0.440988</td>\n","      <td>0.134221</td>\n","      <td>0.154193</td>\n","      <td>0.178460</td>\n","      <td>0.189183</td>\n","      <td>0.210886</td>\n","      <td>0.260803</td>\n","      <td>0.305724</td>\n","      <td>0.356081</td>\n","      <td>0.382678</td>\n","      <td>52.342318</td>\n","    </tr>\n","    <tr>\n","      <th>15</th>\n","      <td>HLM</td>\n","      <td>0.138605</td>\n","      <td>0.294424</td>\n","      <td>0.474125</td>\n","      <td>0.131814</td>\n","      <td>0.165584</td>\n","      <td>0.187996</td>\n","      <td>0.202900</td>\n","      <td>0.216252</td>\n","      <td>0.258028</td>\n","      <td>0.306399</td>\n","      <td>0.353465</td>\n","      <td>0.393399</td>\n","      <td>49.973833</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>IFB2</td>\n","      <td>0.137638</td>\n","      <td>0.303295</td>\n","      <td>0.532694</td>\n","      <td>0.139675</td>\n","      <td>0.167998</td>\n","      <td>0.187384</td>\n","      <td>0.195368</td>\n","      <td>0.210227</td>\n","      <td>0.278325</td>\n","      <td>0.310714</td>\n","      <td>0.365132</td>\n","      <td>0.399227</td>\n","      <td>50.722557</td>\n","    </tr>\n","    <tr>\n","      <th>16</th>\n","      <td>In_expB2</td>\n","      <td>0.135536</td>\n","      <td>0.301087</td>\n","      <td>0.515228</td>\n","      <td>0.139675</td>\n","      <td>0.169487</td>\n","      <td>0.186743</td>\n","      <td>0.194783</td>\n","      <td>0.208927</td>\n","      <td>0.272726</td>\n","      <td>0.309903</td>\n","      <td>0.365474</td>\n","      <td>0.399571</td>\n","      <td>59.862394</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e516e95b-7b8c-4cf1-9e1c-f872c745af2a')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-e516e95b-7b8c-4cf1-9e1c-f872c745af2a button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-e516e95b-7b8c-4cf1-9e1c-f872c745af2a');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":42}]},{"cell_type":"markdown","source":["### Best Performing Model\n","All subsequent experimentation uses short queries only."],"metadata":{"id":"OqENoJ7kd059"}},{"cell_type":"code","execution_count":43,"metadata":{"id":"wro64XYUNqbB","executionInfo":{"status":"ok","timestamp":1650028367938,"user_tz":-60,"elapsed":1639,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["# Setting up the DFReeKLIM model\n","br = pt.BatchRetrieve(index, controls = {'wmodel': 'DFReeKLIM'})\n","br.setControl('wmodel', 'DFReeKLIM')\n","res = br.transform(short_queries)"]},{"cell_type":"code","source":["def search_engine(query):\n","  ranks = br.search(query)\n","  ranked_podcasts = metadf[metadf.docno.isin(ranks.docno)]   # returned podcasts only\n","  rank_dict = ranks.loc[:,['docno', 'rank']].set_index('docno').T.to_dict('list')   # create dict for ranking\n","  score_dict = ranks.loc[:,['docno', 'score']].set_index('docno').T.to_dict('list')   # create dict for ranking scores\n","\n","  def get_rank(row):\n","    return rank_dict[row][0]\n","\n","  def get_score(row):\n","    return score_dict[row][0]\n","\n","  ranked_podcasts = ranked_podcasts.assign(rank = ranked_podcasts.docno.apply(get_rank))   # add rank to metadata\n","  ranked_podcasts = ranked_podcasts.assign(score = ranked_podcasts.docno.apply(get_score))   # add scores to metadata\n","  \n","  return ranked_podcasts.sort_values(by='rank')   # sort by rank and return ranked list"],"metadata":{"id":"izzq5fZJs3BW","executionInfo":{"status":"ok","timestamp":1650028367940,"user_tz":-60,"elapsed":38,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"execution_count":44,"outputs":[]},{"cell_type":"code","source":["search_engine('christmas special')[:5]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":337},"id":"YWyOCNzmttpI","executionInfo":{"status":"ok","timestamp":1650029311122,"user_tz":-60,"elapsed":447,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"1ce00ccb-94d5-4340-aa7a-3f93edd0e279"},"execution_count":70,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                   episode_uri  \\\n","23047   spotify:episode:1h8FlTZrbXtx3JJfmJD2Rj   \n","69554   spotify:episode:57bfPuB7VYdpv55KsWhEbT   \n","103777  spotify:episode:7sUNF9arhO3LDvK2H8h5cq   \n","81380   spotify:episode:600n9ch8YuNTzL1gC4tur6   \n","26691   spotify:episode:1y1GPZkDEiuEMnkC1DQogr   \n","\n","                                             show_name  \\\n","23047                                       22 Chismis   \n","69554   Goblet Of Wine: A Drunken Harry Potter Podcast   \n","103777                             The Cricket Podcast   \n","81380                                        Caf n Gaf   \n","26691                       The Gregory Dickow Podcast   \n","\n","                                         show_description  \\\n","23047   It’s important to learn about culture especial...   \n","69554   Two British lifelong Harry Potter fans Hannah ...   \n","103777  The best & funniest independent cricket podcas...   \n","81380   The hot topics discussed from all angles 3 mat...   \n","26691   Welcome to the Gregory Dickow Podcast, hosted ...   \n","\n","                                             episode_name  \\\n","23047                 5. Likkle likkle Christmas special    \n","69554   Bonus Ep - Goblet of Mulled Wine: It's Christmas!   \n","103777                       Ep 33: The Christmas Special   \n","81380   Caf n Gaf x St. Bernards Fruit and Veg **fu#k ...   \n","26691   The Seven Miracles of the Christmas Season: Pa...   \n","\n","                                      episode_description   docno  rank  \\\n","23047   Merry Christmas everyone! This week we bring y...   23047     0   \n","69554   Merry Christmas wonderful listeners! In todays...   69554     1   \n","103777  The boys get together for a Christmas special....  103777     2   \n","81380   Johnny Kapiris from St Bernards Fruit and Veg ...   81380     3   \n","26691   On Part 1 of this Christmas special from Grego...   26691     4   \n","\n","            score  \n","23047   16.384604  \n","69554   15.196820  \n","103777  14.708985  \n","81380   14.435559  \n","26691   14.322913  "],"text/html":["\n","  <div id=\"df-b3d6e8fa-4b8a-4da3-a5cc-744398f62b91\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>episode_uri</th>\n","      <th>show_name</th>\n","      <th>show_description</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","      <th>docno</th>\n","      <th>rank</th>\n","      <th>score</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>23047</th>\n","      <td>spotify:episode:1h8FlTZrbXtx3JJfmJD2Rj</td>\n","      <td>22 Chismis</td>\n","      <td>It’s important to learn about culture especial...</td>\n","      <td>5. Likkle likkle Christmas special</td>\n","      <td>Merry Christmas everyone! This week we bring y...</td>\n","      <td>23047</td>\n","      <td>0</td>\n","      <td>16.384604</td>\n","    </tr>\n","    <tr>\n","      <th>69554</th>\n","      <td>spotify:episode:57bfPuB7VYdpv55KsWhEbT</td>\n","      <td>Goblet Of Wine: A Drunken Harry Potter Podcast</td>\n","      <td>Two British lifelong Harry Potter fans Hannah ...</td>\n","      <td>Bonus Ep - Goblet of Mulled Wine: It's Christmas!</td>\n","      <td>Merry Christmas wonderful listeners! In todays...</td>\n","      <td>69554</td>\n","      <td>1</td>\n","      <td>15.196820</td>\n","    </tr>\n","    <tr>\n","      <th>103777</th>\n","      <td>spotify:episode:7sUNF9arhO3LDvK2H8h5cq</td>\n","      <td>The Cricket Podcast</td>\n","      <td>The best &amp; funniest independent cricket podcas...</td>\n","      <td>Ep 33: The Christmas Special</td>\n","      <td>The boys get together for a Christmas special....</td>\n","      <td>103777</td>\n","      <td>2</td>\n","      <td>14.708985</td>\n","    </tr>\n","    <tr>\n","      <th>81380</th>\n","      <td>spotify:episode:600n9ch8YuNTzL1gC4tur6</td>\n","      <td>Caf n Gaf</td>\n","      <td>The hot topics discussed from all angles 3 mat...</td>\n","      <td>Caf n Gaf x St. Bernards Fruit and Veg **fu#k ...</td>\n","      <td>Johnny Kapiris from St Bernards Fruit and Veg ...</td>\n","      <td>81380</td>\n","      <td>3</td>\n","      <td>14.435559</td>\n","    </tr>\n","    <tr>\n","      <th>26691</th>\n","      <td>spotify:episode:1y1GPZkDEiuEMnkC1DQogr</td>\n","      <td>The Gregory Dickow Podcast</td>\n","      <td>Welcome to the Gregory Dickow Podcast, hosted ...</td>\n","      <td>The Seven Miracles of the Christmas Season: Pa...</td>\n","      <td>On Part 1 of this Christmas special from Grego...</td>\n","      <td>26691</td>\n","      <td>4</td>\n","      <td>14.322913</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b3d6e8fa-4b8a-4da3-a5cc-744398f62b91')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-b3d6e8fa-4b8a-4da3-a5cc-744398f62b91 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-b3d6e8fa-4b8a-4da3-a5cc-744398f62b91');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":70}]},{"cell_type":"markdown","source":["### Where does the model struggle?"],"metadata":{"id":"6umFTPRDlb4V"}},{"cell_type":"code","execution_count":46,"metadata":{"id":"pSz1tKDHvdb_","executionInfo":{"status":"ok","timestamp":1650028367943,"user_tz":-60,"elapsed":31,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"97b19287-b553-4ad1-a71a-87e51521eec6","colab":{"base_uri":"https://localhost:8080/","height":112}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["    map  ndcg\n","12  0.0   0.0\n","44  0.0   0.0"],"text/html":["\n","  <div id=\"df-e91c8f15-3042-41f4-b7c3-51634b12ba77\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>12</th>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","    </tr>\n","    <tr>\n","      <th>44</th>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e91c8f15-3042-41f4-b7c3-51634b12ba77')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-e91c8f15-3042-41f4-b7c3-51634b12ba77 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-e91c8f15-3042-41f4-b7c3-51634b12ba77');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":46}],"source":["# MAP and NDCG per query\n","eval_per_q = pt.Utils.evaluate(res,qrel,metrics=['map', 'ndcg'], perquery=True)\n","eval_per_q = pd.DataFrame(eval_per_q).T\n","poor_queries = eval_per_q.loc[eval_per_q.ndcg < 0.001]\n","poor_queries"]},{"cell_type":"code","execution_count":47,"metadata":{"id":"1X11bXc8FPMS","executionInfo":{"status":"ok","timestamp":1650028368360,"user_tz":-60,"elapsed":446,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"de2b505d-adc2-490b-fefa-8d4cee80fc3e","colab":{"base_uri":"https://localhost:8080/","height":112}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   qid                        query\n","11  12            imran khan career\n","43  44  thanksgiving comedy special"],"text/html":["\n","  <div id=\"df-2c5ef479-dfc1-478d-9738-0f71a0b23f75\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>query</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>11</th>\n","      <td>12</td>\n","      <td>imran khan career</td>\n","    </tr>\n","    <tr>\n","      <th>43</th>\n","      <td>44</td>\n","      <td>thanksgiving comedy special</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-2c5ef479-dfc1-478d-9738-0f71a0b23f75')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-2c5ef479-dfc1-478d-9738-0f71a0b23f75 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-2c5ef479-dfc1-478d-9738-0f71a0b23f75');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":47}],"source":["# queries for which the model did not perform so well\n","short_queries.loc[short_queries.qid.isin(poor_queries.index)]"]},{"cell_type":"markdown","source":["#### Example"],"metadata":{"id":"melSA0RKz5eP"}},{"cell_type":"code","execution_count":48,"metadata":{"id":"xvLU4xOsGfS7","executionInfo":{"status":"ok","timestamp":1650028368362,"user_tz":-60,"elapsed":33,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"06a9e356-104f-4a6b-c0b0-7788ac3f6433","colab":{"base_uri":"https://localhost:8080/","height":337}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                  episode_uri  \\\n","21220  spotify:episode:1YuWNqCaeHGLis8tX75X2m   \n","98385  spotify:episode:7GkTOhkqwEzVW7QXITFtrE   \n","86849  spotify:episode:6Pfo6qnHlRec2k2UOVzrLP   \n","21726  spotify:episode:1bBazW6F47ytoC7drmJ8ak   \n","67530  spotify:episode:4yL55U2t9x10GzVquyHnkq   \n","\n","                                  show_name  \\\n","21220       IndieWire's Millions of Screens   \n","98385  LOL Comedy Showcase: Stand UP Comedy   \n","86849                          Draft Queens   \n","21726  LOL Comedy Showcase: Stand UP Comedy   \n","67530               The Pat McAfee Show 2.0   \n","\n","                                        show_description  \\\n","21220  Millions of Screens, IndieWire’s brand new TV ...   \n","98385  Need a laugh? We have the best stand up comedy...   \n","86849  Just two gals trying to make sports more aweso...   \n","21726  Need a laugh? We have the best stand up comedy...   \n","67530  On \"The Pat McAfee Show,\" Pat McAfee and his f...   \n","\n","                                            episode_name  \\\n","21220  Thankful For The Reginaissance, Too Much TV, a...   \n","98385     Jamie Foxx - Unleashed Stand Up Comedy Special   \n","86849  EP10: Fantasy Week 13; The History of Thanksgi...   \n","21726                     Martin Lawrence - You So Crazy   \n","67530  PMS 2.0 136 - Thanksgiving Giveaway Extravagan...   \n","\n","                                     episode_description  docno  rank  \\\n","21220  On this week's Thanksgiving-themed episode, Be...  21220     0   \n","98385  Enjoy Jamie Foxx - Unleashed Stand Up Comedy S...  98385     1   \n","86849  Thanksgiving is here. Fantasy playoffs are her...  86849     2   \n","21726  Enjoy Martin Lawrence's stand up comedy specia...  21726     3   \n","67530  Happy Thanksgiving! On today’s show, Pat and t...  67530     4   \n","\n","           score  \n","21220  20.088052  \n","98385  17.369922  \n","86849  15.707870  \n","21726  15.674277  \n","67530  15.112820  "],"text/html":["\n","  <div id=\"df-49191f92-1f45-4702-b671-c283c51f0fc3\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>episode_uri</th>\n","      <th>show_name</th>\n","      <th>show_description</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","      <th>docno</th>\n","      <th>rank</th>\n","      <th>score</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>21220</th>\n","      <td>spotify:episode:1YuWNqCaeHGLis8tX75X2m</td>\n","      <td>IndieWire's Millions of Screens</td>\n","      <td>Millions of Screens, IndieWire’s brand new TV ...</td>\n","      <td>Thankful For The Reginaissance, Too Much TV, a...</td>\n","      <td>On this week's Thanksgiving-themed episode, Be...</td>\n","      <td>21220</td>\n","      <td>0</td>\n","      <td>20.088052</td>\n","    </tr>\n","    <tr>\n","      <th>98385</th>\n","      <td>spotify:episode:7GkTOhkqwEzVW7QXITFtrE</td>\n","      <td>LOL Comedy Showcase: Stand UP Comedy</td>\n","      <td>Need a laugh? We have the best stand up comedy...</td>\n","      <td>Jamie Foxx - Unleashed Stand Up Comedy Special</td>\n","      <td>Enjoy Jamie Foxx - Unleashed Stand Up Comedy S...</td>\n","      <td>98385</td>\n","      <td>1</td>\n","      <td>17.369922</td>\n","    </tr>\n","    <tr>\n","      <th>86849</th>\n","      <td>spotify:episode:6Pfo6qnHlRec2k2UOVzrLP</td>\n","      <td>Draft Queens</td>\n","      <td>Just two gals trying to make sports more aweso...</td>\n","      <td>EP10: Fantasy Week 13; The History of Thanksgi...</td>\n","      <td>Thanksgiving is here. Fantasy playoffs are her...</td>\n","      <td>86849</td>\n","      <td>2</td>\n","      <td>15.707870</td>\n","    </tr>\n","    <tr>\n","      <th>21726</th>\n","      <td>spotify:episode:1bBazW6F47ytoC7drmJ8ak</td>\n","      <td>LOL Comedy Showcase: Stand UP Comedy</td>\n","      <td>Need a laugh? We have the best stand up comedy...</td>\n","      <td>Martin Lawrence - You So Crazy</td>\n","      <td>Enjoy Martin Lawrence's stand up comedy specia...</td>\n","      <td>21726</td>\n","      <td>3</td>\n","      <td>15.674277</td>\n","    </tr>\n","    <tr>\n","      <th>67530</th>\n","      <td>spotify:episode:4yL55U2t9x10GzVquyHnkq</td>\n","      <td>The Pat McAfee Show 2.0</td>\n","      <td>On \"The Pat McAfee Show,\" Pat McAfee and his f...</td>\n","      <td>PMS 2.0 136 - Thanksgiving Giveaway Extravagan...</td>\n","      <td>Happy Thanksgiving! On today’s show, Pat and t...</td>\n","      <td>67530</td>\n","      <td>4</td>\n","      <td>15.112820</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-49191f92-1f45-4702-b671-c283c51f0fc3')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-49191f92-1f45-4702-b671-c283c51f0fc3 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-49191f92-1f45-4702-b671-c283c51f0fc3');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":48}],"source":["# example of query with poor performance\n","search_engine('thanksgiving comedy special')[:5]"]},{"cell_type":"code","source":["# there is only one relevant episode\n","qrel[(qrel.qid == '44') & (qrel.label != 0)]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":81},"id":"oEyjRE0ExiMm","executionInfo":{"status":"ok","timestamp":1650028368362,"user_tz":-60,"elapsed":31,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"c3319623-7fa1-4ba3-d6cb-9705e017477f"},"execution_count":49,"outputs":[{"output_type":"execute_result","data":{"text/plain":["     qid  docno  label\n","4389  44  50608      4"],"text/html":["\n","  <div id=\"df-c76edc76-87fc-4d01-97e9-ce1d8ad442b1\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>qid</th>\n","      <th>docno</th>\n","      <th>label</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>4389</th>\n","      <td>44</td>\n","      <td>50608</td>\n","      <td>4</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-c76edc76-87fc-4d01-97e9-ce1d8ad442b1')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-c76edc76-87fc-4d01-97e9-ce1d8ad442b1 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-c76edc76-87fc-4d01-97e9-ce1d8ad442b1');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":49}]},{"cell_type":"code","source":["metadf[metadf.docno == '50608']"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":81},"id":"9R1gJf9e0iEi","executionInfo":{"status":"ok","timestamp":1650028368364,"user_tz":-60,"elapsed":32,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"91435005-1629-49a9-a43b-4f7aa102362a"},"execution_count":50,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                  episode_uri               show_name  \\\n","50608  spotify:episode:3hx0urDB6fmYZUs5ZlRQdB  Old Time Radio Forever   \n","\n","                                        show_description  \\\n","50608  Join host Matthew Perry every week as he bring...   \n","\n","                   episode_name  \\\n","50608  Jack Benny Thanksgiving    \n","\n","                                     episode_description  docno  \n","50608  1953  ---   This episode is sponsored by  · An...  50608  "],"text/html":["\n","  <div id=\"df-99806098-8cfb-43f3-a159-1155b6ecaddb\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>episode_uri</th>\n","      <th>show_name</th>\n","      <th>show_description</th>\n","      <th>episode_name</th>\n","      <th>episode_description</th>\n","      <th>docno</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>50608</th>\n","      <td>spotify:episode:3hx0urDB6fmYZUs5ZlRQdB</td>\n","      <td>Old Time Radio Forever</td>\n","      <td>Join host Matthew Perry every week as he bring...</td>\n","      <td>Jack Benny Thanksgiving</td>\n","      <td>1953  ---   This episode is sponsored by  · An...</td>\n","      <td>50608</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-99806098-8cfb-43f3-a159-1155b6ecaddb')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-99806098-8cfb-43f3-a159-1155b6ecaddb button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-99806098-8cfb-43f3-a159-1155b6ecaddb');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":50}]},{"cell_type":"code","source":["# there is no mention of 'thanksgiving comedy special' in the description\n","pd.options.display.max_colwidth = 200\n","metadf.loc[[50608],['episode_description']]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":81},"id":"78BYXGvt9uvy","executionInfo":{"status":"ok","timestamp":1650028368365,"user_tz":-60,"elapsed":32,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"1aaa6dd1-0657-4a3a-b7ed-48798f4b5757"},"execution_count":51,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                                                                                                                                                                      episode_description\n","50608  1953  ---   This episode is sponsored by  · Anchor: The easiest way to make a podcast.  https://anchor.fm/app  Support this podcast: https://anchor.fm/oldtimeradioforever/support"],"text/html":["\n","  <div id=\"df-e4db2931-24a2-42a0-bc82-cb937862dfeb\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>episode_description</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>50608</th>\n","      <td>1953  ---   This episode is sponsored by  · Anchor: The easiest way to make a podcast.  https://anchor.fm/app  Support this podcast: https://anchor.fm/oldtimeradioforever/support</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-e4db2931-24a2-42a0-bc82-cb937862dfeb')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-e4db2931-24a2-42a0-bc82-cb937862dfeb button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-e4db2931-24a2-42a0-bc82-cb937862dfeb');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":51}]},{"cell_type":"code","source":["pd.options.display.max_colwidth = 50"],"metadata":{"id":"izuOJaUsn1Yd","executionInfo":{"status":"ok","timestamp":1650028368366,"user_tz":-60,"elapsed":31,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"execution_count":52,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"X9GaQ3GIRg_T"},"source":["##Learning to rank\n","\n","For RandomForest, LightGBM, XGBoost, and Coordinate Ascent with Pyterrier: https://github.com/terrier-org/pyterrier/blob/master/docs/ltr.rst"]},{"cell_type":"code","source":["# Split given by Spotify\n","sq_train = short_queries.loc[0:7]\n","sq_test = short_queries.loc[8:55]\n","\n","qrel_train = qrel.loc[0:609]\n","qrel_test = qrel.loc[610:10035]"],"metadata":{"id":"IQU-anambz_V","executionInfo":{"status":"ok","timestamp":1650028368367,"user_tz":-60,"elapsed":32,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"execution_count":53,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"YGeTAXfsahZZ"},"source":["###RandomForest"]},{"cell_type":"code","execution_count":54,"metadata":{"id":"88_M6VqlajlV","executionInfo":{"status":"ok","timestamp":1650028368764,"user_tz":-60,"elapsed":428,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}}},"outputs":[],"source":["pipeline = pt.FeaturesBatchRetrieve(index, wmodel=\"DFReeKLIM\", features=[\"WMODEL:DLH13\", \"WMODEL:DFIZ\"])\n","DFReeKLIM = pt.BatchRetrieve(index, controls = {'wmodel': 'DFReeKLIM'})"]},{"cell_type":"code","execution_count":55,"metadata":{"id":"V8UBpgw-a9zA","executionInfo":{"status":"ok","timestamp":1650028375702,"user_tz":-60,"elapsed":6943,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"colab":{"base_uri":"https://localhost:8080/","height":112},"outputId":"76832e6c-f27f-47fe-bd9f-db6c72985c07"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["                 name       map      ndcg  recip_rank       R@5      R@10  \\\n","0  DFReeKLIM Baseline  0.153589  0.331247    0.536294  0.155383  0.180385   \n","1    RandomForest LTR  0.026685  0.162459    0.133972  0.019385  0.024086   \n","\n","       R@15      R@20      R@30     R@100     R@200     R@500    R@1000  \\\n","0  0.201065  0.212840  0.233672  0.323175  0.353242  0.398359  0.424263   \n","1  0.036593  0.041297  0.078770  0.151341  0.187479  0.268172  0.424263   \n","\n","         mrt  \n","0  49.324196  \n","1  28.361160  "],"text/html":["\n","  <div id=\"df-0b60d76d-c49b-41d3-8ffc-4ed3edff93c8\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","      <th>recip_rank</th>\n","      <th>R@5</th>\n","      <th>R@10</th>\n","      <th>R@15</th>\n","      <th>R@20</th>\n","      <th>R@30</th>\n","      <th>R@100</th>\n","      <th>R@200</th>\n","      <th>R@500</th>\n","      <th>R@1000</th>\n","      <th>mrt</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>DFReeKLIM Baseline</td>\n","      <td>0.153589</td>\n","      <td>0.331247</td>\n","      <td>0.536294</td>\n","      <td>0.155383</td>\n","      <td>0.180385</td>\n","      <td>0.201065</td>\n","      <td>0.212840</td>\n","      <td>0.233672</td>\n","      <td>0.323175</td>\n","      <td>0.353242</td>\n","      <td>0.398359</td>\n","      <td>0.424263</td>\n","      <td>49.324196</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>RandomForest LTR</td>\n","      <td>0.026685</td>\n","      <td>0.162459</td>\n","      <td>0.133972</td>\n","      <td>0.019385</td>\n","      <td>0.024086</td>\n","      <td>0.036593</td>\n","      <td>0.041297</td>\n","      <td>0.078770</td>\n","      <td>0.151341</td>\n","      <td>0.187479</td>\n","      <td>0.268172</td>\n","      <td>0.424263</td>\n","      <td>28.361160</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-0b60d76d-c49b-41d3-8ffc-4ed3edff93c8')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-0b60d76d-c49b-41d3-8ffc-4ed3edff93c8 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-0b60d76d-c49b-41d3-8ffc-4ed3edff93c8');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":55}],"source":["from sklearn.ensemble import RandomForestRegressor\n","rf = RandomForestRegressor(n_estimators=400)\n","rf_pipe = pipeline >> pt.ltr.apply_learned_model(rf)\n","rf_pipe.fit(sq_train, qrel_train)\n","pt.Experiment([DFReeKLIM, rf_pipe], sq_test, qrel_test, [\"map\", \"ndcg\", \"recip_rank\", \"recall\", \"mrt\"], names=[\"DFReeKLIM Baseline\", \"RandomForest LTR\"])"]},{"cell_type":"markdown","source":["###LightGBM"],"metadata":{"id":"ofIJOgExbEqF"}},{"cell_type":"code","source":["import lightgbm as lgb\n","\n","lmart_l = lgb.LGBMRanker(task=\"train\",\n","    min_data_in_leaf=1,\n","    min_sum_hessian_in_leaf=100,\n","    max_bin=255,\n","    num_leaves=7,\n","    objective=\"lambdarank\",\n","    metric=\"map\",\n","    map_eval_at=[],\n","    learning_rate= .1,\n","    importance_type=\"gain\",\n","    num_iterations=5)\n","lmart_l_pipe = pipeline >> pt.ltr.apply_learned_model(lmart_l, form=\"ltr\")\n","lmart_l_pipe.fit(sq_train, qrel_train, sq_test, qrel_test)\n","\n","pt.Experiment(\n","    [DFReeKLIM, lmart_l_pipe],\n","    sq_test,\n","    qrel_test,\n","    [\"map\", \"ndcg\", \"recip_rank\", \"recall\", \"mrt\"],\n","    names=[\"DFReeKLIM Baseline\", \"LightGBM LTR\"])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":239},"id":"9rlXvpIEbD22","executionInfo":{"status":"ok","timestamp":1650028378862,"user_tz":-60,"elapsed":3164,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"63e81405-a02c-4fbf-ea76-80cbed810bb7"},"execution_count":56,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/lightgbm/engine.py:118: UserWarning: Found `num_iterations` in params. Will use it instead of argument\n","  warnings.warn(\"Found `{}` in params. Will use it instead of argument\".format(alias))\n"]},{"output_type":"stream","name":"stdout","text":["[1]\tvalid_0's map@1: 0.291667\n","[2]\tvalid_0's map@1: 0.3125\n","[3]\tvalid_0's map@1: 0.3125\n","[4]\tvalid_0's map@1: 0.3125\n","[5]\tvalid_0's map@1: 0.333333\n"]},{"output_type":"execute_result","data":{"text/plain":["                 name       map      ndcg  recip_rank       R@5      R@10  \\\n","0  DFReeKLIM Baseline  0.153589  0.331247    0.536294  0.155383  0.180385   \n","1        LightGBM LTR  0.048602  0.205634    0.220634  0.040120  0.047427   \n","\n","       R@15      R@20      R@30     R@100     R@200     R@500    R@1000  \\\n","0  0.201065  0.212840  0.233672  0.323175  0.353242  0.398359  0.424263   \n","1  0.055517  0.070196  0.113101  0.235543  0.283394  0.367968  0.424263   \n","\n","         mrt  \n","0  25.818762  \n","1  10.812347  "],"text/html":["\n","  <div id=\"df-beab4958-2500-4e66-a51e-ce15ed0acaa9\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","      <th>recip_rank</th>\n","      <th>R@5</th>\n","      <th>R@10</th>\n","      <th>R@15</th>\n","      <th>R@20</th>\n","      <th>R@30</th>\n","      <th>R@100</th>\n","      <th>R@200</th>\n","      <th>R@500</th>\n","      <th>R@1000</th>\n","      <th>mrt</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>DFReeKLIM Baseline</td>\n","      <td>0.153589</td>\n","      <td>0.331247</td>\n","      <td>0.536294</td>\n","      <td>0.155383</td>\n","      <td>0.180385</td>\n","      <td>0.201065</td>\n","      <td>0.212840</td>\n","      <td>0.233672</td>\n","      <td>0.323175</td>\n","      <td>0.353242</td>\n","      <td>0.398359</td>\n","      <td>0.424263</td>\n","      <td>25.818762</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>LightGBM LTR</td>\n","      <td>0.048602</td>\n","      <td>0.205634</td>\n","      <td>0.220634</td>\n","      <td>0.040120</td>\n","      <td>0.047427</td>\n","      <td>0.055517</td>\n","      <td>0.070196</td>\n","      <td>0.113101</td>\n","      <td>0.235543</td>\n","      <td>0.283394</td>\n","      <td>0.367968</td>\n","      <td>0.424263</td>\n","      <td>10.812347</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-beab4958-2500-4e66-a51e-ce15ed0acaa9')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-beab4958-2500-4e66-a51e-ce15ed0acaa9 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-beab4958-2500-4e66-a51e-ce15ed0acaa9');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":56}]},{"cell_type":"markdown","source":["###XGBoost"],"metadata":{"id":"AQ6BxOsffSg8"}},{"cell_type":"code","source":["import xgboost as xgb\n","lmart_x = xgb.sklearn.XGBRanker(objective='rank:map',\n","      learning_rate=0.1,\n","      gamma=1.0,\n","      min_child_weight=0.1,\n","      max_depth=6,\n","      verbose=2,\n","      random_state=42)\n","lmart_x_pipe = pipeline >> pt.ltr.apply_learned_model(lmart_x, form=\"ltr\")\n","lmart_x_pipe.fit(sq_train, qrel_train, sq_test, qrel_test)\n","\n","pt.Experiment(\n","    [DFReeKLIM, lmart_x_pipe],\n","    sq_test,\n","    qrel_test,\n","    [\"map\", \"ndcg\", \"recip_rank\", \"recall\", \"mrt\"],\n","    names=[\"DFReeKLIM Baseline\", \"XGBoost LTR\"]\n",")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":112},"id":"3mxnMCHofRcK","executionInfo":{"status":"ok","timestamp":1650028382647,"user_tz":-60,"elapsed":3791,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"949f3299-5a3e-4e3f-e886-f4e3241ddd01"},"execution_count":57,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                 name       map      ndcg  recip_rank       R@5      R@10  \\\n","0  DFReeKLIM Baseline  0.153589  0.331247    0.536294  0.155383  0.180385   \n","1         XGBoost LTR  0.050709  0.209543    0.237564  0.037490  0.042903   \n","\n","       R@15      R@20      R@30     R@100     R@200     R@500    R@1000  \\\n","0  0.201065  0.212840  0.233672  0.323175  0.353242  0.398359  0.424263   \n","1  0.048692  0.065433  0.124761  0.245247  0.301451  0.384037  0.424263   \n","\n","         mrt  \n","0  25.027791  \n","1  10.028913  "],"text/html":["\n","  <div id=\"df-221ea05f-4987-43dc-8a43-25e5d2dcc141\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","      <th>recip_rank</th>\n","      <th>R@5</th>\n","      <th>R@10</th>\n","      <th>R@15</th>\n","      <th>R@20</th>\n","      <th>R@30</th>\n","      <th>R@100</th>\n","      <th>R@200</th>\n","      <th>R@500</th>\n","      <th>R@1000</th>\n","      <th>mrt</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>DFReeKLIM Baseline</td>\n","      <td>0.153589</td>\n","      <td>0.331247</td>\n","      <td>0.536294</td>\n","      <td>0.155383</td>\n","      <td>0.180385</td>\n","      <td>0.201065</td>\n","      <td>0.212840</td>\n","      <td>0.233672</td>\n","      <td>0.323175</td>\n","      <td>0.353242</td>\n","      <td>0.398359</td>\n","      <td>0.424263</td>\n","      <td>25.027791</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>XGBoost LTR</td>\n","      <td>0.050709</td>\n","      <td>0.209543</td>\n","      <td>0.237564</td>\n","      <td>0.037490</td>\n","      <td>0.042903</td>\n","      <td>0.048692</td>\n","      <td>0.065433</td>\n","      <td>0.124761</td>\n","      <td>0.245247</td>\n","      <td>0.301451</td>\n","      <td>0.384037</td>\n","      <td>0.424263</td>\n","      <td>10.028913</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-221ea05f-4987-43dc-8a43-25e5d2dcc141')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-221ea05f-4987-43dc-8a43-25e5d2dcc141 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-221ea05f-4987-43dc-8a43-25e5d2dcc141');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":57}]},{"cell_type":"markdown","source":["###FastRank: Coordinate Ascent"],"metadata":{"id":"2NaqlK5yBd0e"}},{"cell_type":"code","source":["!pip install fastrank\n","import fastrank"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"najj-w3jBcyJ","executionInfo":{"status":"ok","timestamp":1650028386178,"user_tz":-60,"elapsed":3544,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"3eb8ebb2-f203-4b0c-a687-a05bb673262e"},"execution_count":58,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting fastrank\n","  Downloading fastrank-0.7.0-py3-none-manylinux2010_x86_64.whl (891 kB)\n","\u001b[?25l\r\u001b[K     |▍                               | 10 kB 20.8 MB/s eta 0:00:01\r\u001b[K     |▊                               | 20 kB 10.2 MB/s eta 0:00:01\r\u001b[K     |█                               | 30 kB 8.8 MB/s eta 0:00:01\r\u001b[K     |█▌                              | 40 kB 8.1 MB/s eta 0:00:01\r\u001b[K     |█▉                              | 51 kB 4.5 MB/s eta 0:00:01\r\u001b[K     |██▏                             | 61 kB 5.3 MB/s eta 0:00:01\r\u001b[K     |██▋                             | 71 kB 5.4 MB/s eta 0:00:01\r\u001b[K     |███                             | 81 kB 5.4 MB/s eta 0:00:01\r\u001b[K     |███▎                            | 92 kB 5.9 MB/s eta 0:00:01\r\u001b[K     |███▊                            | 102 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████                            | 112 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████▍                           | 122 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████▉                           | 133 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████▏                          | 143 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████▌                          | 153 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████▉                          | 163 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████▎                         | 174 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████▋                         | 184 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████                         | 194 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████▍                        | 204 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████▊                        | 215 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████                        | 225 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████▌                       | 235 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████▉                       | 245 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████▏                      | 256 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████▋                      | 266 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████                      | 276 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████▎                     | 286 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████▋                     | 296 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████                     | 307 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████▍                    | 317 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████▊                    | 327 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████▏                   | 337 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████▌                   | 348 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████▉                   | 358 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████▎                  | 368 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████▋                  | 378 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████                  | 389 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████▍                 | 399 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████▊                 | 409 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████                 | 419 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████▍                | 430 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████▉                | 440 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████▏               | 450 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████▌               | 460 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████               | 471 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████▎              | 481 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████▋              | 491 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████              | 501 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████▍             | 512 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████▊             | 522 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████▏            | 532 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████▌            | 542 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████▉            | 552 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████▏           | 563 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████▋           | 573 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████           | 583 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████▎          | 593 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████▊          | 604 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████          | 614 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▍         | 624 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████▉         | 634 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████████▏        | 645 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████████▌        | 655 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████        | 665 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████▎       | 675 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████▋       | 686 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████       | 696 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▍      | 706 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████▊      | 716 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████      | 727 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▌     | 737 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████▉     | 747 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▏    | 757 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████▋    | 768 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████    | 778 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▎   | 788 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████▊   | 798 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████   | 808 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▍  | 819 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |█████████████████████████████▊  | 829 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▏ | 839 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▌ | 849 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |██████████████████████████████▉ | 860 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▎| 870 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |███████████████████████████████▋| 880 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 890 kB 5.2 MB/s eta 0:00:01\r\u001b[K     |████████████████████████████████| 891 kB 5.2 MB/s \n","\u001b[?25hRequirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from fastrank) (1.21.5)\n","Requirement already satisfied: cffi in /usr/local/lib/python3.7/dist-packages (from fastrank) (1.15.0)\n","Requirement already satisfied: attrs in /usr/local/lib/python3.7/dist-packages (from fastrank) (21.4.0)\n","Requirement already satisfied: pycparser in /usr/local/lib/python3.7/dist-packages (from cffi->fastrank) (2.21)\n","Installing collected packages: fastrank\n","Successfully installed fastrank-0.7.0\n"]}]},{"cell_type":"code","source":["train_request = fastrank.TrainRequest.coordinate_ascent()\n","params = train_request.params\n","params.init_random = True\n","params.normalize = True\n","params.seed = 1234567\n","\n","ca_pipe = pipeline >> pt.ltr.apply_learned_model(train_request, form=\"fastrank\")\n","ca_pipe.fit(sq_train, qrel_train)\n","pt.Experiment([DFReeKLIM, ca_pipe], sq_test, qrel_test, [\"map\", \"ndcg\", \"recip_rank\", \"recall\", \"mrt\"], names=[\"DFReeKLIM Baseline\", \"Coordinate Ascent LTR\"])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":112},"id":"vwIDtOiNBoUL","executionInfo":{"status":"ok","timestamp":1650028391177,"user_tz":-60,"elapsed":5017,"user":{"displayName":"Thomas Allen","userId":"17040925567424440747"}},"outputId":"cc16327b-df71-4901-b6ce-d17022891f6a"},"execution_count":59,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                    name       map      ndcg  recip_rank       R@5      R@10  \\\n","0     DFReeKLIM Baseline  0.153589  0.331247    0.536294  0.155383  0.180385   \n","1  Coordinate Ascent LTR  0.087891  0.260173    0.359811  0.071029  0.116601   \n","\n","       R@15      R@20      R@30     R@100     R@200     R@500    R@1000  \\\n","0  0.201065  0.212840  0.233672  0.323175  0.353242  0.398359  0.424263   \n","1  0.141450  0.160394  0.183094  0.287701  0.337958  0.391154  0.424263   \n","\n","         mrt  \n","0  42.890389  \n","1  23.987971  "],"text/html":["\n","  <div id=\"df-57003173-9015-4a29-9d63-a20fe87f9f33\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>name</th>\n","      <th>map</th>\n","      <th>ndcg</th>\n","      <th>recip_rank</th>\n","      <th>R@5</th>\n","      <th>R@10</th>\n","      <th>R@15</th>\n","      <th>R@20</th>\n","      <th>R@30</th>\n","      <th>R@100</th>\n","      <th>R@200</th>\n","      <th>R@500</th>\n","      <th>R@1000</th>\n","      <th>mrt</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>DFReeKLIM Baseline</td>\n","      <td>0.153589</td>\n","      <td>0.331247</td>\n","      <td>0.536294</td>\n","      <td>0.155383</td>\n","      <td>0.180385</td>\n","      <td>0.201065</td>\n","      <td>0.212840</td>\n","      <td>0.233672</td>\n","      <td>0.323175</td>\n","      <td>0.353242</td>\n","      <td>0.398359</td>\n","      <td>0.424263</td>\n","      <td>42.890389</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>Coordinate Ascent LTR</td>\n","      <td>0.087891</td>\n","      <td>0.260173</td>\n","      <td>0.359811</td>\n","      <td>0.071029</td>\n","      <td>0.116601</td>\n","      <td>0.141450</td>\n","      <td>0.160394</td>\n","      <td>0.183094</td>\n","      <td>0.287701</td>\n","      <td>0.337958</td>\n","      <td>0.391154</td>\n","      <td>0.424263</td>\n","      <td>23.987971</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-57003173-9015-4a29-9d63-a20fe87f9f33')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-57003173-9015-4a29-9d63-a20fe87f9f33 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-57003173-9015-4a29-9d63-a20fe87f9f33');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":59}]}],"metadata":{"colab":{"collapsed_sections":[],"name":"Spotify PyTerrier (Latest)","provenance":[{"file_id":"1fVPdMaywB_XhPul0Lg1ELPXzxMZGtim7","timestamp":1649683897581},{"file_id":"172WKJw7bA_iIoTbHA139W6B-TnVDMhFk","timestamp":1647342446980},{"file_id":"1GiGXV-quLGJOXb7nCH7pJxsLm1QObl9f","timestamp":1647094117276}]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"accelerator":"GPU"},"nbformat":4,"nbformat_minor":0}